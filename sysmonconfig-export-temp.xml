<!--
  A Sysmon configuration file (Temp)
  Author: 		Jakawal Ongthongkum
  Version:		1.1
  Created:		2021-08-09
  Updated: 		2021-10-31
-->

<Sysmon schemaversion="4.83">
	<EventFiltering>

	<!--SYSMON EVENT ID 7 : DLL (IMAGE) LOADED BY PROCESS [ImageLoad]-->
	<!--DATA: UtcTime, ProcessGuid, ProcessId, Image, ImageLoaded, Hashes, Signed, Signature, SignatureStatus-->
	<!--Caution: Can cause high system load, disabled by default.-->
	<RuleGroup name="ImageLoad_Include_Group" groupRelation="or">
		<ImageLoad onmatch="include">
			<Rule name="MSDT_Loading_diagnostic_library,Dogwalk/follina" groupRelation="and">
				<Image condition="image">msdt.exe</Image>
				<ImageLoaded condition="contains">sdiageng.dll</ImageLoaded>
			</Rule>
			<Rule name="Printer_Exploit" groupRelation="and">
				<ImageLoaded condition="contains any">\spool\drivers\x64\3\;\spool\drivers\W32X86\3\;\spool\drivers\IA64\3\</ImageLoaded>
				<Image condition="contains any">spoolsv.exe;printisolationhost.exe</Image>
				<SignatureStatus condition="excludes">Valid</SignatureStatus>
				<Company condition="excludes any">Brother Industries;Canon;Sharp;Microsoft Corporation;DYMO;Euro Plus d.o.o;HP Inc;Hewlett-Packard</Company>
			</Rule>
			<Rule name="DLL_Image_Load_by_System_in_Suspicious_Locations" groupRelation="and">
				<Image condition="begin with">C:\Windows\</Image>
				<ImageLoaded condition="contains any">\Users\Public\;\Desktop\;\Downloads\;\AppData\Local\Temp\;\PerfLogs\;$Recycle;\Fonts\</ImageLoaded>
				<ImageLoaded condition="excludes any">\Program Files</ImageLoaded>
			</Rule>
			<Rule name="Equation_editor_loading_itself" groupRelation="and">
				<Image condition="image">EQNEDT32.EXE</Image>
				<ImageLoaded condition="contains">EQNEDT32.EXE</ImageLoaded>
			</Rule>
			<Rule name="Windows_AD_Services_DLL_Loading_in_Susicious_Directories" groupRelation="and">
				<ImageLoaded condition="contains any">ACTIVEDS.DLL;Adsldpc.dll;Wldap32.dll;adsldp.dll</ImageLoaded>
				<Image condition="contains any">C:\Users;\Temp\;\ProgramData\</Image>
			</Rule>
			<Rule name="Windows_AD_Services_DLL_Loading_by_Suspicious_Process" groupRelation="and">
				<ImageLoaded condition="contains any">ACTIVEDS.DLL;Adsldpc.dll;Wldap32.dll;adsldp.dll</ImageLoaded>
				<Image condition="contains any">\wscript.exe;\cscript.exe;\powershell.exe;\powershell_ise.exe;\rundll32.exe;\msbuild.exe;\csc.exe</Image>
			</Rule>
			<Rule name="VBE6_Macro_Image_Loads_with_wshom" groupRelation="and">
				<Image condition="contains any">WINWORD.exe;EXCEL.EXE</Image>
				<ImageLoaded condition="contains all">VBEUI.DLL;VBE6.DLL;VBE6INTL.DLL;wshom.ocx</ImageLoaded>
				<ImageLoaded condition="excludes all">wbemdisp.dll;wbemcomn.dll;wbemprox.dll;wmiutils.dll;wbemsvc.dll;fastprox.dll</ImageLoaded>
			</Rule>
			<Rule name="VBE7_Macro_Image_Loads_with_wshom" groupRelation="and">
				<Image condition="contains any">WINWORD.exe;EXCEL.EXE</Image>
				<ImageLoaded condition="contains all">VBE7.DLL;VBE7INTL.DLL;VBEUI.DLL;wshom.ocx</ImageLoaded>
				<ImageLoaded condition="excludes all">wbemdisp.dll;wbemcomn.dll;wbemprox.dll;wmiutils.dll;wbemsvc.dll</ImageLoaded>
			</Rule>
			<Rule name="VBE6_Macro_Image_Loads_with_WMI" groupRelation="and">
				<Image condition="contains any">WINWORD.exe;EXCEL.EXE</Image>
				<ImageLoaded condition="contains all">VBEUI.DLL;VBE6.DLL;VBE6INTL.DLL;wbemdisp.dll;wbemcomn.dll;wbemprox.dll;wmiutils.dll;wbemsvc.dll</ImageLoaded>
			</Rule>
			<Rule name="VBE7_Macro_Image_Loads_with_WMI" groupRelation="and">
				<Image condition="contains any">WINWORD.exe;EXCEL.EXE</Image>
				<ImageLoaded condition="contains all">VBE7.DLL;VBE7INTL.DLL;VBEUI.DLL;wbemdisp.dll;wbemcomn.dll;wbemprox.dll;wmiutils.dll;wbemsvc.dll</ImageLoaded>
			</Rule>
			<Rule name="Office_taskschd.dll_Load" groupRelation="and">
				<Image condition="contains any">WINWORD.exe;EXCEL.EXE</Image>
				<ImageLoaded condition="end with">taskschd.dll</ImageLoaded>
			</Rule>
			<Rule name="Office_clr.dll_Load" groupRelation="and">
				<Image condition="contains any">WINWORD.exe;EXCEL.EXE</Image>
				<ImageLoaded condition="end with">clr.dll</ImageLoaded>
			</Rule>
			<Rule name="WScript_taskschd.dll_Load" groupRelation="and">
				<Image condition="contains any">wscript.exe;cscript.exe</Image>
				<ImageLoaded condition="end with">taskschd.dll</ImageLoaded>
			</Rule>
			<Rule name="WMI_taskschd.dll_Load" groupRelation="and">
				<Image condition="image">wmiprvse.exe</Image>
				<ImageLoaded condition="end with">taskschd.dll</ImageLoaded>
			</Rule>
			<Rule name="Powershell_Loading_MSI.dll" groupRelation="and">
				<Image condition="image">powershell.exe</Image>
				<ImageLoaded condition="end with">msi.dll</ImageLoaded>
			</Rule>
			<Rule name="Powershell_Loading_AMSI.dll" groupRelation="and">
				<Image condition="contains">powershell</Image>
				<ImageLoaded condition="end with">amsi.dll</ImageLoaded>
			</Rule>
			<Rule name="Powershell_Not_Loading_AMSI.dll" groupRelation="and">
				<Image condition="excludes">powershell</Image>
				<ImageLoaded condition="end with">amsi.dll</ImageLoaded>
			</Rule>
			<Rule name="Monitor_logoncli.dll_dll_loads_for_injection,potential_qbot_activity" groupRelation="and">
				<ImageLoaded condition="end with">logoncli.dll</ImageLoaded>
				<Image condition="is not">C:\Windows\System32\wbem\WmiPrvSE.exe</Image>
			</Rule>
			<Rule name="Wscript_Internet_Access_library_Loads" groupRelation="and">
				<Image condition="contains any">wscript.exe;cscript.exe</Image>
				<ImageLoaded condition="contains all">msxml;wshom.ocx</ImageLoaded>
			</Rule>
			<Rule name="Wscript_Internet_Access_library_Loads_2" groupRelation="and">
				<Image condition="contains any">wscript.exe;cscript.exe</Image>
				<ImageLoaded condition="contains all">winhttp.dll;mswsock.dll;IPHLPAPI.DLL</ImageLoaded>
			</Rule>
			<Rule name="Interesting_Installutil_DLL_Loads" groupRelation="and">
				<Image condition="contains any">installutil.exe</Image>
				<ImageLoaded condition="contains all">CustomMarshalers.dll;CustomMarshalers.ni.dll;System.Management.ni.dll;WMINet_Utils.dll;mswsock.dll</ImageLoaded>
			</Rule>
			<Rule name="Automation_NI_DLL_Loaded" groupRelation="and">
				<ImageLoaded condition="end with">System.Management.Automation.ni.dll</ImageLoaded>
				<ImageLoaded condition="begin with">C:\Windows\Microsoft.NET\assembly\GAC_MSIL\</ImageLoaded>
			</Rule>
			<Rule name="Automation_DLL_Loaded" groupRelation="and">
				<ImageLoaded condition="end with">System.Management.Automation.dll</ImageLoaded>
				<ImageLoaded condition="begin with">C:\Windows\Microsoft.NET\assembly\GAC_MSIL\</ImageLoaded>
				<ImageLoaded condition="excludes any">Lenovo.Vantage.AddinHost;\Microsoft.Sara.exe;C:\Program Files\CONEXANT</ImageLoaded>
			</Rule>
			<Rule name="Credential_Manager_DLL_Loaded" groupRelation="and">
				<ImageLoaded condition="is">C:\Windows\System32\vaultcli.dll</ImageLoaded>
				<Image condition="excludes any">\svchost.exe;\GameBar.exe;C:\Program Files\WindowsApps;\Microsoft\Teams\current\Teams.exe</Image>
			</Rule>
			<Rule name="UNC_Path_Image_Loaded" groupRelation="and">
				<ImageLoaded condition="begin with">\\</ImageLoaded>
			</Rule>
			<Rule name="WLL_Office_Application_Startup" groupRelation="and">
				<ImageLoaded condition="contains">\Microsoft\Word\Startup\</ImageLoaded>
				<ImageLoaded condition="end with">.wll</ImageLoaded>
			</Rule>
			<Rule name="XLL_Office_Application_Startup" groupRelation="and">
				<ImageLoaded condition="contains">\Microsoft\Excel\Startup\</ImageLoaded>
				<ImageLoaded condition="end with">.xll</ImageLoaded>
			</Rule>
			<Rule name="Office_Application_Startup_Generic" groupRelation="and">
				<ImageLoaded condition="contains">\Microsoft\Addins\</ImageLoaded>
				<ImageLoaded condition="contains any">.xla</ImageLoaded>
			</Rule>
			<Rule name="Mimikatz_Cred_Dumping" groupRelation="and">
				<Image condition="image">rundll32.exe</Image>
				<ImageLoaded condition="contains all">vaultcli.dll;wlanapi.dll</ImageLoaded>
				<ImageLoaded condition="excludes">combase.dll</ImageLoaded>
				<ImageLoaded condition="excludes">cryptdll.dll</ImageLoaded>
				<ImageLoaded condition="excludes">imm32.dll</ImageLoaded>
				<ImageLoaded condition="excludes">logoncli.dll</ImageLoaded>
				<ImageLoaded condition="excludes">netapi32.dll</ImageLoaded>
				<ImageLoaded condition="excludes">ntasn1.dll</ImageLoaded>
				<ImageLoaded condition="excludes">ntdsapi.dll</ImageLoaded>
				<ImageLoaded condition="excludes">samlib.dll</ImageLoaded>
				<ImageLoaded condition="excludes">shcore.dll</ImageLoaded>
				<ImageLoaded condition="excludes">srvcli.dll</ImageLoaded>
			</Rule>
			<Rule name="Explorer_Loading_Powershell_in_memory" groupRelation="and">
				<Image condition="image">C:\Windows\Explorer.EXE</Image>
				<ImageLoaded condition="is">C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe</ImageLoaded>
			</Rule>
			<Rule name="Programdata_Image_Loading_exe_Image_from_Programdata" groupRelation="and">
				<Image condition="begin with">C:\ProgramData\</Image>
				<ImageLoaded condition="begin with">C:\ProgramData\</ImageLoaded>
				<ImageLoaded condition="end with">.exe</ImageLoaded>
				<Company condition="excludes">Adobe</Company>
				<Image condition="excludes">C:\ProgramData\Lenovo\</Image>
				<ImageLoaded condition="excludes">C:\ProgramData\Microsoft\Windows Defender\</ImageLoaded>
				<ImageLoaded condition="excludes">C:\ProgramData\sysmon\sysmon64.exe</ImageLoaded>
			</Rule>
			<Rule name="Suspicious_Image_loaded_within_Default_or_Public_Directory" groupRelation="and">
				<ImageLoaded condition="contains any">C:\Users\Default\;C:\Users\Public\</ImageLoaded>
				<ImageLoaded condition="end with">.exe</ImageLoaded>
			</Rule>
			<Rule name="Suspicious_Image_loaded_within_Default_or_Public_Directory" groupRelation="and">
				<ImageLoaded condition="contains any">C:\Users\Default\;C:\Users\Public\</ImageLoaded>
				<ImageLoaded condition="end with">.dll</ImageLoaded>
			</Rule>
			<Rule name="Sept_2022_Exchange_0day_DLL_detection" groupRelation="or">
				<Hashes condition="contains">SHA256=074eb0e75bb2d8f59f1fd571a8c5b76f9c899834893da6f7591b68531f2b5d82</Hashes>
				<Hashes condition="contains">SHA256=45c8233236a69a081ee390d4faa253177180b2bd45d8ed08369e07429ffbe0a9</Hashes>
				<Hashes condition="contains">SHA256=9ceca98c2b24ee30d64184d9d2470f6f2509ed914dafb87604123057a14c57c0</Hashes>
				<Hashes condition="contains">SHA256=29b75f0db3006440651c6342dc3c0672210cfb339141c75e12f6c84d990931c3</Hashes>
				<Hashes condition="contains">SHA256=c8c907a67955bcdf07dd11d35f2a23498fb5ffe5c6b5d7f36870cf07da47bff2</Hashes>
				<Hashes condition="contains">SHA256=76a2f2644cb372f540e179ca2baa110b71de3370bb560aca65dcddbd7da3701e</Hashes>
			</Rule>
			<Rule name="SVCHost_loading_Unsigned_DLL" groupRelation="and">
				<Image condition="image">C:\Windows\System32\svchost.exe</Image>
				<Signed condition="is">false</Signed>
			</Rule>
			<Rule name="T1170,MSHTA_with_AMSI_Bypass" groupRelation="and">
				<ImageLoaded condition="contains any">jscript.dll;jscript9.dll</ImageLoaded>
				<Image condition="image">mshta.exe</Image>
			</Rule>
			<Rule name="T1003,OS_Credential_Dumping,Wireless_Credential_Dumping" groupRelation="and">
				<ImageLoaded condition="end with">C:\Windows\System32\wlanapi.dll</ImageLoaded>
				<Image condition="excludes">C:\Program Files\NVIDIA Corporation\NVIDIA GeForce Experience\NVIDIA Share.exe</Image>
				<Image condition="excludes">C:\Program Files\NVIDIA Corporation\NVIDIA GeForce Experience\NVIDIA Share.exe</Image>
				<Image condition="excludes">C:\Program Files\WindowsApps\MicrosoftWindows.Client.WebExperience</Image>
				<Image condition="excludes">C:\Windows\ImmersiveControlPanel\SystemSettings.exe</Image>
				<Image condition="excludes">C:\Windows\ImmersiveControlPanel\SystemSettings.exe</Image>
				<Image condition="excludes">C:\Windows\System32\AppHostRegistrationVerifier.exe</Image>
				<Image condition="excludes">C:\Windows\System32\CompatTelRunner.exe</Image>
				<Image condition="excludes">C:\Windows\System32\DeviceCensus.exe</Image>
				<Image condition="excludes">C:\Windows\System32\DriverStore\FileRepository\</Image>
				<Image condition="excludes">C:\Windows\System32\LogonUI.exe</Image>
				<Image condition="excludes">C:\Windows\System32\MoNotificationUx.exe</Image>
				<Image condition="excludes">C:\Windows\System32\SystemSettingsBroker.exe</Image>
				<Image condition="excludes">C:\Windows\System32\dxgiadaptercache.exe</Image>
				<Image condition="excludes">C:\Windows\System32\netsh.exe</Image>
				<Image condition="excludes">C:\Windows\System32\wlanext.exe</Image>
				<Image condition="excludes">C:\Windows\UUS\amd64\MoUsoCoreWorker.exe</Image>
				<Image condition="excludes">C:\Windows\WinSxS\amd64_microsoft-windows-servicingstack_</Image>
				<Image condition="excludes">C:\Windows\explorer.exe</Image>
			</Rule>
			<Rule name="Unsigned_Global_Assembly_Cache_Load" groupRelation="and">
				<ImageLoaded condition="begin with">C:\Windows\Microsoft.NET\assembly\GAC_MSIL</ImageLoaded>
				<Signed condition="is">false</Signed>
			</Rule>
			<Rule name="Signed_Global_Assembly_Cache_Load" groupRelation="and">
				<ImageLoaded condition="begin with">C:\Windows\Microsoft.NET\assembly\GAC_MSIL</ImageLoaded>
				<Signed condition="is">true</Signed>
			</Rule>
			<Rule name="T0137.005,Startup_Items" groupRelation="and">
				<Image condition="end with">bginfo.exe</Image>
				<ImageLoaded condition="contains any">System.ni.dll;System.Core.ni.dll</ImageLoaded>
			</Rule>
			<Rule name="T1055,Process_Injection" groupRelation="and">
				<OriginalFileName condition="is any">clr.dll;clrjit.dll;mscoreei.dll;mscoree.dll;mscoreeis.dll;mscorlib.dll;mscorlib.ni.dll</OriginalFileName>
				<Image condition="excludes">C:\Windows\Microsoft.NET\</Image>
			</Rule>
			<Rule name="T1175,Component_Object_Model_and_Distributed_COM" groupRelation="and">
				<Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
				<OriginalFileName condition="is any">combase.dll;coml2.dll;comsvcs.dll</OriginalFileName>
			</Rule>
			<Rule name="T1055,Process_Injection" groupRelation="and">
				<Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
				<ImageLoaded condition="begin with">C:\Windows\assembly\</ImageLoaded>
			</Rule>
			<Rule name="T1055,Process_Injection" groupRelation="and">
				<Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
				<ImageLoaded condition="begin with">C:\Windows\Microsoft.NET\assembly\GAC_MSIL</ImageLoaded>
			</Rule>
			<Rule name="T1055,Process_Injection" groupRelation="and">
				<Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
				<OriginalFileName condition="is">clr.dll</OriginalFileName>
			</Rule>
			<Rule name="T1059.005,Command_and_Scripting_Interpreter_VBScript" groupRelation="and">
				<Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
				<OriginalFileName condition="is any">VBE7INTL.DLL;VBE7.DLL;VBEUI.DLL</OriginalFileName>
			</Rule>
			<Rule name="T1137.001,Office_Template_Macros" groupRelation="and">
				<Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
				<OriginalFileName condition="is">OUTLVBA.DLL</OriginalFileName>
			</Rule>
			<Rule name="T1047,Windows_Management_Instrumentation" groupRelation="and">
				<Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
				<ImageLoaded condition="is">C:\Windows\SysWOW64\wbem\wbemdisp.dll</ImageLoaded>
			</Rule>
			<Rule name="T1003.004,LSASS_Memory" groupRelation="and">
				<Image condition="end with">rundll32.exe</Image>
				<OriginalFileName condition="is">comsvcs.dll</OriginalFileName>
			</Rule>
			<ImageLoaded name="Suspicious_Process_Loading_ntkrnlmp.exe" condition="image">ntkrnlmp.exe</ImageLoaded>
			<ImageLoaded name="Suspicious_clr_windows_management_dll_Load" condition="contains all">clr.dll;System.Management.ni.dll;Microsoft.Build.Utilities</ImageLoaded>
			<ImageLoaded name="Ransomware_detected_tor_library" condition="contains">tor-lib.dll</ImageLoaded>
			<ImageLoaded name="Cred_Dumping" condition="is any">C:\Windows\System32\WinSCard.dll;C:\Windows\System32\cryptdll.dll;C:\Windows\System32\hid.dll;C:\Windows\System32\samlib.dll;C:\Windows\System32\vaultcli.dll</ImageLoaded>
			<ImageLoaded name="Potential_C3_Framework" condition="contains all">odbc32.dll;winhttp.dll;netapi32.dll;SHLWAPI.dll</ImageLoaded>
			<Hashes name="Solarwinds/FireEye_sunburst_image_hashes" condition="contains any">56ceb6d0011d87b6e4d7023d7ef85676;4f2eb62fa529c0283b28d05ddd311fae;b91ce2fa41029f6955bff20079468448;b91ce2fa41029f6955bff20079468448;846e27a652a5e1bfbd0ddd38a16dc865;2c4a910a1299cdae2a4e55988a2f102e</Hashes>
			<SignatureStatus name="Revoked_Signature_Libraries_Loaded" condition="is">Revoked</SignatureStatus>
			<SignatureStatus name="Expired_Signature_Libraries_Loaded" condition="is">Expired</SignatureStatus>
			<ImageLoaded condition="end with">scrobj.dll</ImageLoaded>
			<ImageLoaded condition="end with">crypt0.dll</ImageLoaded>
			<ImageLoaded name="T1059.006,Command_and_Scripting_Interpreter,Python_DLL_Loaded" condition="contains any">python</ImageLoaded>
			<ImageLoaded name="T1197,BITS" condition="end with">bitsproxy.dll</ImageLoaded>
			<ImageLoaded name="T1047,Windows_Scheduled_Tasks" condition="end with">mstask.dll</ImageLoaded>
			<ImageLoaded name="T1064,Windows_Scripting_Host_Component" condition="end with">wshom.ocx</ImageLoaded>
			<OriginalFileName condition="is">scrrun.dll</OriginalFileName>
			<OriginalFileName condition="is">vbscript.dll</OriginalFileName>
			<ImageLoaded name="T1137,Office_Application_Startup" condition="end with">.wll</ImageLoaded>
			<ImageLoaded name="T1137,Office_Application_Startup" condition="end with">.xll</ImageLoaded>
			<Image name="T1137,Office_Application_Startup" condition="end with">VSTOInstaller.exe</Image>
			<ImageLoaded name="T1059.001,PowerShell" condition="end with">system.management.automation.ni.dll</ImageLoaded>
			<ImageLoaded name="T1059.001,PowerShell" condition="end with">system.management.automation.dll</ImageLoaded>
			<ImageLoaded name="T1059.001,PowerShell" condition="end with">Microsoft.PowerShell.Commands.Diagnostics.dll</ImageLoaded>
			<ImageLoaded name="T1059.001,PowerShell" condition="end with">Microsoft.PowerShell.Commands.Management.dll</ImageLoaded>
			<ImageLoaded name="T1059.001,PowerShell" condition="end with">Microsoft.PowerShell.Commands.Utility.dll</ImageLoaded>
			<ImageLoaded name="T1059.001,PowerShell" condition="end with">Microsoft.PowerShell.ConsoleHost.dll</ImageLoaded>
			<ImageLoaded name="T1059.001,PowerShell" condition="end with">Microsoft.PowerShell.Security.dll</ImageLoaded>
			<!-- DLL Side-Loading -->
			<ImageLoaded name="T1073,DLL_Side-Loading" condition="contains any">admin$;c$;\\;\appdata\;\temp\</ImageLoaded>
			<ImageLoaded name="T1073,DLL_Side-Loading" condition="begin with" >c:\programdata\</ImageLoaded>
			<ImageLoaded name="T1073,DLL_Side-Loading" condition="begin with">C:\Windows\Media\</ImageLoaded>
			<ImageLoaded name="T1073,DLL_Side-Loading" condition="begin with">C:\Windows\addins\</ImageLoaded>
			<ImageLoaded name="T1073,DLL_Side-Loading" condition="begin with">C:\Windows\system32\config\systemprofile\</ImageLoaded>
			<ImageLoaded name="T1073,DLL_Side-Loading" condition="begin with">C:\Windows\Debug\</ImageLoaded>
			<ImageLoaded name="T1073,DLL_Side-Loading" condition="begin with">C:\Windows\Temp</ImageLoaded>
			<ImageLoaded name="T1073,DLL_Side-Loading" condition="begin with">C:\PerfLogs\</ImageLoaded>
			<ImageLoaded name="T1073,DLL_Side-Loading" condition="begin with">C:\Windows\Help\</ImageLoaded>
			<ImageLoaded name="T1073,DLL_Side-Loading" condition="begin with">C:\Intel\Logs\</ImageLoaded>
			<ImageLoaded name="T1073,DLL_Side-Loading" condition="begin with">C:\Temp</ImageLoaded>
			<ImageLoaded name="T1073,DLL_Side-Loading" condition="begin with">C:\Windows\repair\</ImageLoaded>
			<ImageLoaded name="T1073,DLL_Side-Loading" condition="begin with">C:\Windows\security\</ImageLoaded>
			<ImageLoaded name="T1073,DLL_Side-Loading" condition="begin with">C:\Windows\Fonts\</ImageLoaded>
			<ImageLoaded name="T1073,DLL_Side-Loading" condition="contains">Downloads</ImageLoaded>
			<ImageLoaded name="T1073,DLL_Side-Loading" condition="contains">Public</ImageLoaded>
			<ImageLoaded name="T1073,DLL_Side-Loading" condition="contains">Documents</ImageLoaded>
			<ImageLoaded name="T1073,DLL_Side-Loading" condition="contains">Music</ImageLoaded>
			<ImageLoaded name="T1073,DLL_Side-Loading" condition="contains">Video</ImageLoaded>
			<ImageLoaded name="T1073,DLL_Side-Loading" condition="begin with">file:</ImageLoaded>
			<ImageLoaded name="T1073,DLL_Side-Loading" condition="contains">$Recycle.bin\</ImageLoaded>
			<ImageLoaded name="T1073,DLL_Side-Loading" condition="contains">\Windows\IME\</ImageLoaded>
		</ImageLoad>
	</RuleGroup>

	<RuleGroup name="ImageLoad_Exclude_Group" groupRelation="or">
		<ImageLoad onmatch="exclude">
			<Rule name="XLL_Office_Application_Startup_removal" groupRelation="and">
				<Image condition="contains">\Microsoft Office\</Image>
				<ImageLoaded condition="end with">\mscorlib.ni.dll</ImageLoaded>
			</Rule>
			<Rule name="XLL_Office_Application_Startup_removal" groupRelation="and">
				<Image condition="contains">\Microsoft Office\</Image>
				<ImageLoaded condition="end with">\sppc.dll</ImageLoaded>
			</Rule>
			<Rule name="T1137,Office_Application_Startup" groupRelation="and">
				<Image condition="end with">VSTOInstaller.exe</Image>
				<ImageLoaded condition="begin with">C:\Windows\</ImageLoaded>
			</Rule>
			<Rule name="SVCHost_Signed_DLL" groupRelation="and">
				<Image condition="image">C:\Windows\System32\svchost.exe</Image>
				<Signed condition="is">true</Signed>
			</Rule>
			<Rule groupRelation="and">
				<Image condition="is">C:\Windows\System32\cscript.exe</Image>
				<OriginalFileName condition="is">scrobj.dll</OriginalFileName>
			</Rule>
			<Rule groupRelation="and">
				<Image condition="contains all"> C:\Users\;\AppData\Local\Microsoft\OneDrive;\FileCoAuth.exe</Image>
				<ImageLoaded condition="contains all">C:\Users\;\AppData\Local\Microsoft\OneDrive\;\FileSyncTelemetryExtensions.dll</ImageLoaded>
			</Rule>
			<Rule groupRelation="and">
				<Image condition="contains all"> C:\Users\;\AppData\Local\Microsoft\OneDrive;\FileCoAuth.exe</Image>
				<ImageLoaded condition="contains all">C:\Users\;\AppData\Local\Microsoft\OneDrive\;\FileCoAuthLib.dll</ImageLoaded>
			</Rule>
			<Rule groupRelation="and">
				<Image condition="contains all"> C:\Users\;\AppData\Local\Microsoft\OneDrive;\FileCoAuth.exe</Image>
				<ImageLoaded condition="contains all">C:\Users\;\AppData\Local\Microsoft\OneDrive\;\OneDriveTelemetryStable.dll</ImageLoaded>
			</Rule>
			<Rule groupRelation="and">
				<Image condition="contains all"> C:\Users\;\AppData\Local\Microsoft\OneDrive;\FileCoAuth.exe</Image>
				<ImageLoaded condition="contains all">C:\Users\;\AppData\Local\Microsoft\OneDrive\;\vcruntime140.dll</ImageLoaded>
			</Rule>
			<Rule groupRelation="and">
				<Image condition="contains all"> C:\Users\;\AppData\Local\Microsoft\OneDrive;\FileCoAuth.exe</Image>
				<ImageLoaded condition="contains all">C:\Users\;\AppData\Local\Microsoft\OneDrive\;\UpdateRingSettings.dll</ImageLoaded>
			</Rule>
			<Rule groupRelation="and">
				<Image condition="contains all"> C:\Users\;\AppData\Local\Microsoft\OneDrive;\FileCoAuth.exe</Image>
				<ImageLoaded condition="contains all">C:\Users\;\AppData\Local\Microsoft\OneDrive\;\LoggingPlatform.dll</ImageLoaded>
			</Rule>
			<Rule groupRelation="and">
				<Image condition="contains all"> C:\Users\;\AppData\Local\Microsoft\OneDrive;\FileCoAuth.exe</Image>
				<ImageLoaded condition="contains all">C:\Users\;\AppData\Local\Microsoft\OneDrive\;\FileCoAuth.exe</ImageLoaded>
			</Rule>
			<!--Universal Exclusions: Be Careful-->
			<Rule name="Antivirus Exclusions" groupRelation="or"> 
				<Image condition="begin with">C:\Program Files (x86)\Kaspersky Lab</Image> 
				<Image condition="begin with">C:\Program Files\Kaspersky Lab</Image>
				<Image condition="begin with">C:\Program Files (x86)\ESET</Image>
				<Image condition="begin with">C:\Program Files\ESET</Image>
				<Image condition="begin with">C:\ProgramData\Microsoft\Windows Defender\</Image>
			</Rule>
			<Company condition="contains">Fortinet</Company>
			<Company condition="contains">Lenovo</Company>
			<Company condition="contains">Sophos</Company>
			<Image condition="end with">mscorsvw.exe</Image>
			<Image condition="image">C:\Program Files (x86)\Microsoft Office\root\Office15\officebackgroundtaskhandler.exe</Image>
			<Image condition="image">C:\Program Files (x86)\Microsoft Office\root\Office16\officebackgroundtaskhandler.exe</Image>
			<Image condition="image">C:\Program Files\Microsoft Office\root\Office15\officebackgroundtaskhandler.exe</Image>
			<Image condition="image">C:\Program Files\Microsoft Office\root\Office16\officebackgroundtaskhandler.exe</Image>
			<Image condition="image">C:\Windows\SysWOW64\SearchProtocolHost.exe</Image>
			<Image condition="image">C:\Windows\System32\InstallAgentUserBroker.exe</Image>
			<Image condition="image">C:\Windows\System32\RuntimeBroker.exe</Image>
			<Image condition="image">C:\Windows\System32\SearchIndexer.exe</Image>
			<Image condition="image">C:\Windows\System32\SettingSyncHost.exe</Image>
			<Image condition="image">C:\Windows\System32\backgroundTaskHost.exe</Image>
			<Image condition="image">C:\Windows\System32\sppsvc.exe</Image>
			<Image condition="image">C:\Windows\System32\taskhost.exe</Image>
			<Image condition="image">C:\Windows\System32\taskhostw.exe</Image>
			<Image condition="image">C:\Windows\SystemApps\Microsoft.AAD.BrokerPlugin_cw5n1h2txyewy\Microsoft.AAD.BrokerPlugin.exe</Image>
			<Image condition="image">C:\Windows\SystemApps\Microsoft.Windows.Cortana_cw5n1h2txyewy\SearchUI.exe</Image>
			<Image condition="image">HxTsr.exe</Image>
			<Image condition="image">SearchUI.exe</Image>
			<ImageLoaded condition="contains">C:\Program Files (x86)\Common Files\BIExcelFunctions1.1\32bit\Sage.</ImageLoaded>
			<ImageLoaded condition="contains">C:\Windows\Microsoft.NET\assembly\GAC_MSIL\Pfx.</ImageLoaded>
			<ImageLoaded condition="is">C:\Program Files (x86)\Adobe\Acrobat 10.0\Acrobat\Adist64.dll</ImageLoaded>
			<ImageLoaded condition="is">C:\Program Files (x86)\Microsoft Office\Office15\Library\Analysis\ANALYS32.XLL</ImageLoaded>
			<ImageLoaded condition="is">C:\Program Files (x86)\Microsoft Office\Office16\Library\Analysis\ANALYS32.XLL</ImageLoaded>
			<ImageLoaded condition="is">C:\Program Files\Microsoft Office\Office15\Library\Analysis\ANALYS32.XLL</ImageLoaded>
			<ImageLoaded condition="is">C:\Program Files\Microsoft Office\Office16\Library\Analysis\ANALYS32.XLL</ImageLoaded>
			<ImageLoaded condition="is">C:\Windows\SysWOW64\sppc.dll</ImageLoaded>
			<ImageLoaded condition="end with">Microsoft.Office.Interop.VisOcx.dll</ImageLoaded>
			<ImageLoaded condition="end with">Microsoft.Office.Interop.Word.dll</ImageLoaded>
			<ImageLoaded condition="end with">Microsoft.Vbe.Interop.dll</ImageLoaded>
			<ImageLoaded condition="end with">OFFICE.DLL</ImageLoaded>
		</ImageLoad>
	</RuleGroup>

	<!--SYSMON EVENT ID 10 : INTER-PROCESS ACCESS [ProcessAccess]-->
	<!--COMMENT:	Can cause high system load, disabled by default.-->
	<!--DATA: UtcTime, SourceProcessGuid, SourceProcessId, SourceThreadId, SourceImage, TargetProcessGuid, TargetProcessId, TargetImage, GrantedAccess, CallTrace-->
	<RuleGroup name="ProcessAccess_Include_Group" groupRelation="or">
		<ProcessAccess onmatch="include">
			<Rule name="T1059.005,Command_and_Scripting_Interpreter,CSShellExecute_ExecuteAssoc" groupRelation="and">
				<CallTrace condition="contains">C:\Windows\System32\SHELL32.dll+9b5bd</CallTrace>
				<TargetImage condition="excludes">\LocalBridge.exe</TargetImage>
			</Rule>
			<Rule name="T1047.005,WMI,CWbemProviderGlueExecMethodAsync" groupRelation="and">
				<CallTrace condition="contains">C:\Windows\SYSTEM32\framedynos.dll+2cb3e</CallTrace>
				<TargetImage condition="excludes any">C:\Windows\system32\SgrmBroker.exe;C:\Windows\system32\SecurityHealthService.exe;C:\ProgramData\Microsoft\Windows Defender\platform\;C:\Windows\system32\services.exe;C:\Windows\system32\wininit.exe;C:\Windows\system32\sppsvc.exe;C:\Windows\System32\smss.exe;C:\Windows\system32\csrss.exe;C:\Windows\System32\svchost.exe</TargetImage>
			</Rule>
			<Rule name="T1055,Process_Injection,Suspicious_In-Memory_Module_Execution_1" groupRelation="and">
				<CallTrace condition="contains all">C:\Windows\\SYSTEM32\ntdll.dll+;|C:\Windows\System32\KERNELBASE.dll+;|UNKNOWN(</CallTrace>
				<CallTrace condition="end with">)</CallTrace>
			</Rule>
			<Rule name="T1055,Process_Injection,Suspicious_In-Memory_Module_Execution_2" groupRelation="and">
				<CallTrace condition="contains all">"UNKNOWN(;)|UNKNOWN(</CallTrace>
				<CallTrace condition="end with">)</CallTrace>
			</Rule>
			<Rule name="T1055,Process_Injection,Suspicious_In-Memory_Module_Execution_3" groupRelation="and">
				<CallTrace condition="contains all">"UNKNOWN</CallTrace>
				<GrantedAccess condition="contains any">0x1F0FFF;0x1F1FFF;0x143A;0x1410;0x1010;0x1F2FFF;0x1F3FFF;0x1FFFFF</GrantedAccess>
			</Rule>
			<Rule name="T1055,Process_Injection,Office_Macro_Injection_Detected" groupRelation="and">
				<SourceImage condition="contains all">C:\Program Files;\Microsoft Office\Root\Office</SourceImage>
				<CallTrace condition="contains">\Microsoft Shared\VBA</CallTrace>
				<TargetImage condition="excludes">C:\Program Files (x86)\Intuit\</TargetImage>
			</Rule>
			<Rule name="T1003,OS_Credential_Dumping,LSASS_Credential_Access" groupRelation="and">
				<TargetImage condition="image">C:\Windows\system32\lsass.exe</TargetImage>
				<GrantedAccess>0x1FFFFF</GrantedAccess>
				<CallTrace condition="contains">UNKNOWN</CallTrace>
				<CallTrace condition="excludes">WmiPerfClass.dll</CallTrace>
				<SourceImage condition="excludes any">C:\Windows\sysWOW64\wbem\wmiprvse.exe;C:\Windows\system32\wbem\wmiprvse.exe;C:\Program Files\VMware\VMware Tools\vmtoolsd.exe;C:\Program Files (x86)\VMware\VMware Tools\vmtoolsd.exe;WmiPerfClass.dll;C:\Program Files (x86)\Adobe\Adobe Sync\CoreSync\customhook\CoreSyncCustomHook.exe;C:\Program Files\Adobe\Adobe Sync\CoreSync\customhook\CoreSyncCustomHook.exe;C:\Program Files (x86)\Common Files\Adobe</SourceImage>
			</Rule>
			<Rule name="T1003,OS_Credential_Dumping,Mimikatz_through_Windows_Remote_Management" groupRelation="and">
				<TargetImage condition="image">C:\Windows\system32\lsass.exe</TargetImage>
				<SourceImage condition="image">C:\Windows\system32\wsmprovhost.exe</SourceImage>
			</Rule>
			<Rule name="T1003,OS_Credential_Dumping,LSASS_process_access_by_LaZagne" groupRelation="and">
				<TargetImage condition="image">C:\Windows\system32\lsass.exe</TargetImage>
				<GrantedAccess>0x1FFFFF</GrantedAccess>
				<CallTrace condition="contains all">python27.dll;_ctypes.pyd;KERNELBASE.dll;ntdll.dll</CallTrace>
			</Rule>
			<Rule name="T1003,OS_Credential_Dumping,LSASS_process_access_by_Mimikatz" groupRelation="and">
				<TargetImage condition="image">C:\Windows\system32\lsass.exe</TargetImage>
				<CallTrace condition="begin with">C:\Windows\SYSTEM32\ntdll.dll+4595c|C:\Windows\system32\KERNELBASE.dll+8185</CallTrace>
			</Rule>
			<Rule name="T1003,OS_Credential_Dumping,LSASS_Cobalt_Strike_Monitor" groupRelation="and">
				<TargetImage condition="image">C:\Windows\system32\lsass.exe</TargetImage>
				<CallTrace condition="begin with">C:\WINDOWS\SYSTEM32\ntdll.dll+</CallTrace>
				<CallTrace condition="end with">)</CallTrace>
				<CallTrace condition="contains all">|C:\WINDOWS\System32\KERNELBASE.dll+;|UNKNOWN(</CallTrace>
				<CallTrace condition="excludes any">wow64.dll;)|C;Exchange.Diagnostics;Microsoft.Exchange</CallTrace>
				<SourceImage condition="excludes any">C:\Program Files\Bitdefender\Endpoint Security\EPSecurityService.exe;c:\windows\system32\inetsrv\w3wp.exe;MSExchangeHMHost.exe;C:\Windows\sysWOW64\wbem\wmiprvse.exe</SourceImage>
			</Rule>
			<Rule name="T1003,OS_Credential_Dumping,Rubeus_Mimikatz_Like_Detection" groupRelation="and">
				<TargetImage condition="image">C:\Windows\system32\winlogon.exe</TargetImage>
				<GrantedAccess>0x1F3FFF</GrantedAccess>
				<CallTrace condition="contains any">C:\Windows\Microsoft.NET;UNKNOWN</CallTrace>
			</Rule>
			<Rule name="Suspicious_Process_Accessing_Sysmon" groupRelation="and">
				<SourceImage condition="end with">.exe</SourceImage>
				<TargetImage condition="contains any">C:\Windows\sysmon64.exe;C:\Windows\sysmon64.exe</TargetImage>
				<GrantedAccess>0x1C00</GrantedAccess>
			</Rule>
			<Rule name="T1003,OS_Credential_Dumping,LSASS_Access" groupRelation="and">
				<TargetImage condition="image">C:\Windows\system32\lsass.exe</TargetImage>
				<GrantedAccess>0x1F1FFF</GrantedAccess>
				<CallTrace condition="contains">UNKNOWN</CallTrace>
			</Rule>
			<Rule name="T1003,OS_Credential_Dumping,LSASS_Access_2" groupRelation="and">
				<TargetImage condition="image">C:\Windows\system32\lsass.exe</TargetImage>
				<GrantedAccess>0x1010</GrantedAccess>
				<CallTrace condition="contains">UNKNOWN</CallTrace>
			</Rule>
			<Rule name="T1003,OS_Credential_Dumping,LSASS_Access_3" groupRelation="and">
				<TargetImage condition="image">C:\Windows\system32\lsass.exe</TargetImage>
				<GrantedAccess>0x143A</GrantedAccess>
				<CallTrace condition="contains">UNKNOWN</CallTrace>
			</Rule>
			<Rule name="T1003,OS_Credential_Dumping,LSASS_Memory_Dump" groupRelation="and">
				<TargetImage condition="image">C:\Windows\system32\lsass.exe</TargetImage>
				<GrantedAccess>0x1fffff</GrantedAccess>
				<CallTrace condition="contains any">dbghelp.dll;dbgcore.dll</CallTrace>
			</Rule>
			<Rule name="T1003,OS_Credential_Dumping,Process_access_with_dbghelp" groupRelation="and">
				<CallTrace condition="contains any">dbghelp.dll;dbgcore.dll</CallTrace>
				<TargetImage condition="excludes">C:\Windows\system32\lsass.exe</TargetImage>
				<SourceImage condition="excludes">C:\wfx32\</SourceImage>
			</Rule>
			<Rule name="Powershell_accessing_another_process_memory" groupRelation="and">
				<SourceImage condition="image">powershell.exe</SourceImage>
				<TargetImage condition="excludes any">C:\Programdata\sysmon\sysmon64.exe;C:\Programdata\sysmon\sysmon.exe;C:\Windows\sysmon.exe;C:\Windows\sysmon64.exe;\dismhost.exe</TargetImage>
				<CallTrace condition="excludes all">C:\WINDOWS\SYSTEM32\ntdll.dll+;|C:\WINDOWS\System32\KERNELBASE.dll+;|C:\ProgramData\Microsoft\Windows Defender\Platform\;\MPCLIENT.DLL;\MpOav.dll+;|C:\WINDOWS\SYSTEM32\amsi.dll</CallTrace>
			</Rule>
			<Rule name="T1086,PowerShell,Powershell_without_Powershell" groupRelation="and">
				<CallTrace condition="contains">System.Management.Automation</CallTrace>
				<CallTrace condition="excludes">C:\ProgramData\Microsoft\Windows Defender\platform\</CallTrace>
				<CallTrace condition="excludes">ctiuser.dll</CallTrace>
				<SourceImage condition="is not">C:\Program Files\Citrix\ConfigSync\ConfigSyncRun.exe</SourceImage>
				<SourceImage condition="is not">C:\Program Files\Microsoft\Exchange Server\V14\bin\ExSetupUI.exe</SourceImage>
				<SourceImage condition="is not">C:\Program Files\Microsoft\Exchange Server\V15\bin\ExSetupUI.exe</SourceImage>
				<SourceImage condition="is not">C:\Program Files\Microsoft\Exchange Server\V16\bin\ExSetupUI.exe</SourceImage>
				<SourceImage condition="is not">C:\Windows\SysWOW64\sdiagnhost.exe</SourceImage>
				<SourceImage condition="is not">C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe</SourceImage>
				<SourceImage condition="is not">C:\Windows\Temp\ExchangeSetup\ExSetupUI.exe</SourceImage>
				<SourceImage condition="is not">C:\system32\WindowsPowerShell\v1.0\PowerShell_ISE.exe</SourceImage>
				<TargetImage condition="is not">C:\Program Files\Microsoft Azure Active Directory Connect\AzureADConnect.exe</TargetImage>
				<TargetImage condition="is not">C:\Windows\system32\HOSTNAME.EXE</TargetImage>
				<TargetImage condition="is not">C:\Windows\system32\ROUTE.exe</TargetImage>
				<TargetImage condition="is not">C:\Windows\system32\query.exe</TargetImage>
				<TargetImage condition="is not">MsMpEng.exe</TargetImage>
			</Rule>
			<Rule name="T1003,OS_Credential_Dumping,Kaodic_credential_access_detected" groupRelation="and">
				<TargetImage condition="image">C:\Windows\system32\lsass.exe</TargetImage>
				<CallTrace condition="contains">comsvcs.dll</CallTrace>
			</Rule>
			<Rule name="T1059,Scripting,verclsid_Office_Execution" groupRelation="and">
				<SourceImage condition="contains">Office</SourceImage>
				<TargetImage condition="contains">verclsid.exe</TargetImage>
				<CallTrace condition="contains any">VBE7.dll;VBEUI.DLL;VBE7INTL.DLL</CallTrace>
				<CallTrace condition="contains any">|UNKNOWN(</CallTrace>
				<GrantedAccess condition="contains">0x1FFFFF</GrantedAccess>
			</Rule>
			<Rule name="T1059.005,Command_and_Scripting_Interpreter,CreateProcessW" groupRelation="and">
				<SourceImage condition="contains">C:\Program Files\Microsoft Office\Root\Office</SourceImage>
				<CallTrace condition="contains">C:\Windows\System32\KERNELBASE.dll+76516</CallTrace>
			</Rule>
			<Rule name="T1059.005,Command_and_Scripting_Interpreter,CSShellExecute_DoExecute" groupRelation="and">
				<CallTrace condition="contains" >C:\Windows\System32\SHELL32.dll+ae3b9</CallTrace>
				<TargetImage condition="excludes">C:\WINDOWS\system32\sihost.exe</TargetImage>
				<TargetImage condition="excludes">C:\Program Files\WindowsApps\Microsoft.MicrosoftOfficeHub</TargetImage>
			</Rule>
			<Rule name="Typical_ProcessAccess_Pattern_of_CobaltStrike_BOF" groupRelation="and">
				<CallTrace condition="contains">|UNKNOWN(</CallTrace>
				<CallTrace condition="begin with">C:\WINDOWS\SYSTEM32\ntdll.dll+</CallTrace>
				<CallTrace condition="contains">|C:\WINDOWS\System32\KERNELBASE.dll+</CallTrace>
				<CallTrace condition="end with">)</CallTrace>
				<GrantedAccess condition="contains any">0x1028;0x1fffff</GrantedAccess>
				<SourceImage condition="excludes any">C:\Program Files\SmartGit\bin\;C:\Program Files (x86)\ASUS\Update\;C:\Program Files (x86)\Razer\Synapse3\Service\Razer Synapse Service.exe;C:\Program Files (x86)\Citrix\ICA Client\Receiver\UpdaterService.exe;C:\WINDOWS\SysWOW64\config\systemprofile\Citrix\UpdaterBinaries\;C:\Program Files\Mozilla Firefox\firefox.exe;C:\Program Files\SmartGit\git;\Intel\Driver and Support Assistant\DSAService.exe</SourceImage>
				<SourceImage condition="excludes all">C:\Windows\Microsoft.NET\Framework\;\NGenTask.exe</SourceImage>
				<TargetImage condition="excludes any">\Intel\Driver and Support Assistant\</TargetImage>
				<TargetImage condition="excludes all">C:\Windows\Microsoft.NET\Framework\;\ngen.exe</TargetImage>
			</Rule>
			<Rule name="Potential_MalDoc_Behavior" groupRelation="and">
				<SourceImage condition="contains any">winword.exe;excel.exe;powerpnt.exe</SourceImage>
				<CallTrace condition="contains all">:\Windows\Microsoft.NET\Framework64\v2.;UNKNOWN</CallTrace>
			</Rule>
			<Rule name="Potential_Metasploit_Process_Migration" groupRelation="and">
				<CallTrace condition="contains">UNKNOWN</CallTrace>
				<GrantedAccess condition="contains">0x147a</GrantedAccess>
			</Rule>
			<Rule name="T1562.002,Disable_Windows_Event_Logging,SysmonEnte_Detection" groupRelation="and">
				<TargetImage condition="contains any">C:\Windows\Sysmon64.exe;C:\Windows\Sysmon.exe</TargetImage>
				<SourceImage condition="is not">C:\WINDOWS\system32\wbem\wmiprvse.exe</SourceImage>
				<SourceImage condition="is not">C:\Program Files (x86)\ASUS\Update\AsusUpdate.exe</SourceImage>
				<SourceImage condition="is not">C:\Program Files\Intel\SUR\QUEENCREEK\x64\esrv_svc.exe</SourceImage>
				<SourceImage condition="excludes any">C:\ProgramData\Microsoft\Windows Defender\Platform\;\MsMpEng.exe;C:\Program Files (x86)\Microsoft\EdgeUpdate\MicrosoftEdgeUpdate.exe;C:\Program Files (x86)\Google\Update\GoogleUpdate.exe</SourceImage>
				<GrantedAccess condition="contains">0x1400</GrantedAccess>
			</Rule>
			<CallTrace name="T1059.005,Command_and_Scripting_Interpreter,WSHellExec" condition="contains any">C:\Windows\System32\wshom.ocx+c8a0;C:\Windows\System32\wshom.ocx+c39d</CallTrace>
			<CallTrace name="T1047.005,WMI,ProviderExecMethod_1" condition="contains">C:\Windows\SYSTEM32\framedynos.dll+2b496</CallTrace>
			<CallTrace name="T1003.001,Credential_Dumping,MiniDumpWriteDump" condition="contains">C:\Windows\SYSTEM32\dbgcore.DLL+6cfb</CallTrace>
			<CallTrace name="T1003.001,Credential_Dumping,PssCaptureSnapShot" condition="contains">C:\Windows\System32\KernelBase.dll+de67e</CallTrace>
			<CallTrace name="Dotnet_Debugging_detected" condition="contains">ntdll.dll+a0044</CallTrace>
			<CallTrace name="DInvoke_detected" condition="contains any">clr.dll+6c23;clr.dll+6b38</CallTrace>
			<CallTrace name="Potential_Keylogger_detected" condition="contains">getasynckeystate</CallTrace>
			<CallTrace name="T1548.002,Abuse_Elevation_Control_Mechanism,CMSTP_UAC_Bypass" condition="contains">cmlua.dll</CallTrace>
			<CallTrace name="T1059,Scripting,Office_Macro_Execution_VBE7" condition="contains any">VBE7.dll;VBEUI.DLL;VBE7INTL.DLL</CallTrace>
			<CallTrace name="T1059,Scripting,Office_Macro_Execution_VBE6" condition="contains any">VBE6.dll;VBEUI.DLL;VBE6INTL.DLL</CallTrace>
			<!--PROCESS_SUSPEND_RESUME + PROCESS_VM_WRITE: possible memory injection-->
			<GrantedAccess name="T1093,Process_Hollowing">0x0800</GrantedAccess>
			<GrantedAccess name="T1093,Process_Hollowing">0x800</GrantedAccess>
			<!--PROCESS_SUSPEND_RESUME-->
			<GrantedAccess name="T1003,OS_Credential_Dumping,Credential_Dumping_from_Memory_indicator">0x0810</GrantedAccess>
			<GrantedAccess name="T1003,OS_Credential_Dumping,Credential_Dumping_from_Memory_indicator">0x810</GrantedAccess>
			<!--PROCESS_SUSPEND_RESUME + PROCESS_VM_READ: possible memory dump to extract sensitive information-->
			<GrantedAccess name="T1055,Process_Injection,Possible_Memory_Dump">0x0820</GrantedAccess>
			<GrantedAccess name="T1055,Process_Injection,Possible_Memory_Dump">0x820</GrantedAccess>
			<!--Others-->
			<GrantedAccess name="T1093,Process Hollowing">0x21410</GrantedAccess>
			<SourceImage name="CScript_accessing_another_process_memory" condition="end with">cscript.exe</SourceImage>
			<SourceImage name="WScript_accessing_another_process_memory" condition="end with">wscript.exe</SourceImage>
			<SourceImage condition="end with">jjs.exe</SourceImage>
			<CallTrace name="T1003,OS_Credential_Dumping,Credential_Dumping_from_Memory_indicator" condition="contains">dump</CallTrace>
			<CallTrace name="T1003,OS_Credential_Dumping,Credential_Dumping_from_Memory_indicator" condition="contains">mimikatz</CallTrace>
			<CallTrace name="ProcessAccess_with_CorperfmontExt.dll" condition="contains">CorperfmontExt.dll</CallTrace>
		</ProcessAccess>
	</RuleGroup>

	<RuleGroup name="ProcessAccess_Exclude_Group" groupRelation="or">
		<ProcessAccess onmatch="exclude">
			<Rule name="wmi accessing lsass" groupRelation="and">
				<SourceImage condition="image">wmiprvse.exe</SourceImage>
				<TargetImage condition="image">lsass.exe</TargetImage>
			</Rule>
			<Rule name="lsass accessing winlogon" groupRelation="and">
				<SourceImage condition="image">lsass.exe</SourceImage>
				<TargetImage condition="image">winlogon.exe</TargetImage>
			</Rule>
			<Rule groupRelation="and">
				<SourceImage condition="contains all">C:\Users\;\AppData\Local\Microsoft\Teams\current\Teams.exe</SourceImage>
				<TargetImage condition="contains all">C:\Users\;\AppData\Local\Microsoft\Teams\current\Teams.exe</TargetImage>
			</Rule>
			<Rule name="Direct_System_Call_Events" groupRelation="and">
				<CallTrace condition="not begin with">C:\Windows\SYSTEM32\ntdll.dll</CallTrace>  
				<CallTrace condition="not begin with">C:\Windows\SYSTEM32\win32u.dll</CallTrace>
				<CallTrace condition="not begin with">C:\Windows\SYSTEM32\wow64win.dll</CallTrace>
			</Rule>
			<Rule name="Antivirus_Exclusions" groupRelation="or"> 
				<SourceImage condition="begin with">C:\Program Files (x86)\Kaspersky Lab</SourceImage> 
				<SourceImage condition="begin with">C:\Program Files\Kaspersky Lab</SourceImage>
				<SourceImage condition="begin with">C:\Program Files (x86)\ESET</SourceImage>
				<SourceImage condition="begin with">C:\Program Files\ESET</SourceImage>
				<SourceImage condition="begin with">C:\ProgramData\Microsoft\Windows Defender\</SourceImage>
			</Rule>
			<!--These binaries get or access processes running .NET-->
			<SourceImage condition="end with">:\Windows\system32\sppsvc.exe</SourceImage>
			<SourceImage condition="end with">:\Windows\system32\sdiagnhost.exe</SourceImage>
			<!--These binaries appear to access lsass legitimately-->
			<Rule name="legitimate lsass access" groupRelation="and">
				<TargetImage condition="image">lsass.exe</TargetImage>
				<SourceImage condition="excludes any">C:\Windows\system32\w32tm.exe;C:\Windows\System32\ping.exe;C:\Windows\System32\net.exe;C:\Windows\System32\net1.exe;C:\Windows\SYSTEM32\HOSTNAME.EXE;C:\Programdata\sysmon\sysmon.exe;C:\Programdata\sysmon\sysmon64.exe;C:\Program Files\Windows Defender\MsMpEng.exe;C:\Program Files (x86)\BeAnywhere Support Express\;C:\Program Files (x86)\CheckPoint\;C:\Program Files (x86)\Common Files\Intuit\QuickBooks\;C:\Program Files (x86)\Fortinet\;C:\Program Files (x86)\Trend Micro\;C:\Program Files\Adobe\Adobe Creative Cloud Experience\;C:\Program Files\CheckPoint\;C:\Program Files\Fortinet\;C:\Program Files\Realtek;C:\Program Files\Trend Micro\;C:\ProgramData\Microsoft\Windows Defender\platform\;C:\Program Files (x86)\Lenovo\;snmpd.exe;taskmgr;:\Windows\System32\smss.exe;:\Windows\system32\wininit.exe;\Bin\FMS.exe;\EMET_GUI.exe;\EMET_Service.exe;\Google\Update\GoogleUpdate.exe;\RAAGTAPP.EXE;\controls\cef\ConnectWise.exe;C:\Program Files (x86)\Sophos\Sophos Anti-Virus\SavService.exe;C:\Program Files\Hewlett-Packard\AMS\service\hpqams.exe;C:\Program Files\Intel\SUR\WILLAMETTE\ESRV\esrv_svc.exe;C:\Program Files\VMware\VMware Tools\vmtoolsd.exe;C:\Program Files\Windows Defender\MsMpEng.exe;C:\WINDOWS\system32\WerFault.exe;C:\WINDOWS\system32\taskkill.exe;C:\Windows\SysWOW64\WerFault.exe;C:\Windows\System32\snmp.exe;C:\Windows\system32\msiexec.exe;C:\Windows\system32\spoolsv.exe;C:\Windows\system32\svchost.exe</SourceImage>
			</Rule>
			<!--Exclude legitimate software-->
			<SourceImage condition="is">C:\Program Files\Adobe\Adobe Creative Cloud Experience\libs\node.exe</SourceImage>
			<SourceImage condition="contains all">C:\Program Files;\Common Files\Adobe\AdobeGCClient\AGMService.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files (x86)\Adobe\Acrobat DC\Acrobat\Acrobat.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files (x86)\Adobe\Acrobat DC\Acrobat\AcroCEF\AcroCEF.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files (x86)\Common Files\Adobe\ARM\1.0\AdobeARMHelper.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files\Adobe\Adobe Photoshop 2021\Photoshop.exe</SourceImage>
			<TargetImage condition="begin with">C:\Program Files\Autodesk\Autodesk Desktop App</TargetImage>
			<TargetImage condition="begin with">C:\Program Files (x86)\Autodesk\Autodesk Desktop App</TargetImage>
			<SourceImage condition="is">C:\Windows\CarbonBlack\cb.exe</SourceImage>
			<SourceImage condition="contains all">C:\Program Files\Cisco\AMP\;sfc.exe</SourceImage>
			<SourceImage condition="contains all">C:\Users\;\AppData\Local\Cirtix\ICA Client\receiver\Receiver.exe</SourceImage>
			<SourceImage condition="is">c:\Program Files\Couchbase\Server\bin\sigar_port.exe</SourceImage>
			<SourceImage condition="contains all">C:\Program Files;\FireEye\xagt\xagt.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files (x86)\Ivanti\Workspace Control\cpushld.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files (x86)\RES Software\Workspace Manager\cpushld.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files\Ivanti\Workspace Control\cpushld.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files\RES Software\Workspace Manager\cpushld.exe</SourceImage>
			<SourceImage condition="end with">wmiprvse.exe</SourceImage>
			<SourceImage condition="end with">GoogleUpdate.exe</SourceImage>
			<SourceImage condition="end with">LTSVC.exe</SourceImage>
			<SourceImage condition="end with">taskmgr.exe</SourceImage>
			<SourceImage condition="end with">VBoxService.exe</SourceImage>
			<SourceImage condition="end with">vmtoolsd.exe</SourceImage>
			<SourceImage condition="end with">\Citrix\System32\wfshell.exe</SourceImage>
			<SourceImage condition="is">C:\Windows\System32\lsm.exe</SourceImage>
			<SourceImage condition="end with">Microsoft.Identity.AadConnect.Health.AadSync.Host.exe</SourceImage>
			<SourceImage condition="begin with">C:\Program Files (x86)\Symantec\Symantec Endpoint Protection</SourceImage>
			<SourceImage condition="is">C:\Program Files\McAfee\Endpoint Security\Endpoint Security Platform\mfeesp.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files\McAfee\Agent\x86\macompatsvc.exe</SourceImage>
			<SourceImage condition="contains all">C:\Users\;\AppData\Local\Microsoft\OneDrive\StandaloneUpdater\OneDriveSetup.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files\Microsoft Office\root\Office16\OUTLOOK.EXE</SourceImage>
			<SourceImage condition="is">C:\Program Files\Microsoft Security Client\MsMpEng.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files\Windows Defender\MsMpEng.exe</SourceImage>
			<SourceImage condition="contains all">C:\ProgramData\Microsoft\Windows Defender\Platform\;\MsMpEng.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files (x86)\Mobatek\MobaXterm\MobaXterm.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files\Palo Alto Networks\Traps\cyserver.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files\Qualys\QualysAgent\QualysAgent.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files (x86)\Razer Chroma SDK\bin\RzSDKService.exe</SourceImage>
			<SourceImage condition="is">C:\WINDOWS\CCM\CcmExec.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files\Splunk\bin\splunkd.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files (x86)\VMware\VMWare Player\vmware-authd.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files (x86)\VMware\VMware Workstation\vmware-authd.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files\WinZip\FAHWindow64.exe</SourceImage>
			<!--Others-->
			<GrantedAccess>0x1000</GrantedAccess>
			<GrantedAccess>0x1400</GrantedAccess>
			<GrantedAccess>0x101400</GrantedAccess>
			<GrantedAccess>0x101000</GrantedAccess>
			<CallTrace condition="contains">UNKNOWN(00007F</CallTrace>
		</ProcessAccess>
	</RuleGroup>

	<!--SYSMON EVENT ID 19 & 20 & 21 : WMI EVENT MONITORING [WmiEvent]-->
	<!--EVENT 19: "WmiEventFilter activity detected"-->
	<!--EVENT 20: "WmiEventConsumer activity detected"-->
	<!--EVENT 21: "WmiEventConsumerToFilter activity detected"-->
	<!--DATA: EventType, UtcTime, Operation, User, Name, Type, Destination, Consumer, Filter-->
	<RuleGroup groupRelation="or">
		<WmiEvent onmatch="include">
		  	<Operation name="T1047,Windows_Management_Instrumentation" condition="is">Created</Operation>
		</WmiEvent>
	</RuleGroup>

	<!--SYSMON EVENT ID 27 : FILE BLOCK [FileBlockExecutable]-->
	<RuleGroup name="ImageBlock" groupRelation="or">
		<FileBlockExecutable onmatch="include">
			<!-- Executables dropped to suspicious folders -->
			<TargetFilename condition="begin with">C:\Users\Public\</TargetFilename> <!-- often used staging directories; could cause false positives --> 
			<TargetFilename condition="begin with">C:\Perflogs\</TargetFilename> <!-- often used staging directories --> 
			<TargetFilename condition="begin with">C:\Windows\Fonts\</TargetFilename> <!-- often used staging directories --> 
			<TargetFilename condition="begin with">C:\Windows\debug\</TargetFilename> <!-- often used staging directories --> 
			<TargetFilename condition="begin with">C:\Windows\Tasks\</TargetFilename> <!-- often used staging directories --> 
			<TargetFilename condition="begin with">C:\Windows\tracing\</TargetFilename> <!-- often used staging directories --> 
			<TargetFilename condition="begin with">C:\Windows\Help\</TargetFilename> <!-- often used staging directories --> 
			<TargetFilename condition="begin with">C:\Windows\Logs\</TargetFilename> <!-- often used staging directories --> 
			<TargetFilename condition="begin with">C:\Windows\System32\spool\SERVERS\</TargetFilename> <!-- often used in exploits against print spooler --> 
			<TargetFilename condition="begin with">C:\Windows\System32\spool\PRINTERS\</TargetFilename> <!-- often used in exploits against print spooler --> 
			<TargetFilename condition="contains all">C:\Users\;\Music\</TargetFilename> <!-- often used staging directories in User folders --> 
			<TargetFilename condition="contains all">C:\Users\;\Pictures\</TargetFilename> <!-- often used staging directories in User folders --> 
			<TargetFilename condition="contains all">C:\Users\;\Videos\</TargetFilename> <!-- often used staging directories in User folders --> 
			<TargetFilename condition="contains all">C:\Users\;\Contacts\</TargetFilename> <!-- often used staging directories in User folders --> 
			<!-- Executables double extensions -->
			<TargetFilename condition="end with">.pdf.exe</TargetFilename>
			<TargetFilename condition="end with">.doc.exe</TargetFilename>
			<TargetFilename condition="end with">.docx.exe</TargetFilename>
			<TargetFilename condition="end with">.xls.exe</TargetFilename>
			<TargetFilename condition="end with">.xlsx.exe</TargetFilename>
			<TargetFilename condition="end with">.xlsm.exe</TargetFilename>
			<TargetFilename condition="end with">.docm.exe</TargetFilename>
			<TargetFilename condition="end with">.ppt.exe</TargetFilename>
			<TargetFilename condition="end with">.pptx.exe</TargetFilename>
			<TargetFilename condition="end with">.txt.exe</TargetFilename>
			<TargetFilename condition="end with">.rtf.exe</TargetFilename>
			<TargetFilename condition="end with">.htm.exe</TargetFilename>
			<TargetFilename condition="end with">.html.exe</TargetFilename>
			<TargetFilename condition="end with">.iso.exe</TargetFilename>
			<TargetFilename condition="end with">.zip.exe</TargetFilename>
			<TargetFilename condition="end with">.rar.exe</TargetFilename>
			<TargetFilename condition="end with">.7z.exe</TargetFilename>
			<!-- Hacktool Blocks based on Imphashes -->
			<Hashes condition="contains">IMPHASH=BCCA3C247B619DCD13C8CDFF5F123932</Hashes> <!-- PetitPotam -->
			<Hashes condition="contains">IMPHASH=3A19059BD7688CB88E70005F18EFC439</Hashes> <!-- PetitPotam -->
			<Hashes condition="contains">IMPHASH=bf6223a49e45d99094406777eb6004ba</Hashes> <!-- PetitPotam -->
			<Hashes condition="contains">IMPHASH=0C106686A31BFE2BA931AE1CF6E9DBC6</Hashes> <!-- Mimikatz -->
			<Hashes condition="contains">IMPHASH=0D1447D4B3259B3C2A1D4CFB7ECE13C3</Hashes> <!-- Mimikatz -->
			<Hashes condition="contains">IMPHASH=1B0369A1E06271833F78FFA70FFB4EAF</Hashes> <!-- Mimikatz -->
			<Hashes condition="contains">IMPHASH=4C1B52A19748428E51B14C278D0F58E3</Hashes> <!-- Mimikatz -->
			<Hashes condition="contains">IMPHASH=4D927A711F77D62CEBD4F322CB57EC6F</Hashes> <!-- Mimikatz -->
			<Hashes condition="contains">IMPHASH=66EE036DF5FC1004D9ED5E9A94A1086A</Hashes> <!-- Mimikatz -->
			<Hashes condition="contains">IMPHASH=672B13F4A0B6F27D29065123FE882DFC</Hashes> <!-- Mimikatz -->
			<Hashes condition="contains">IMPHASH=6BBD59CEA665C4AFCC2814C1327EC91F</Hashes> <!-- Mimikatz -->
			<Hashes condition="contains">IMPHASH=725BB81DC24214F6ECACC0CFB36AD30D</Hashes> <!-- Mimikatz -->
			<Hashes condition="contains">IMPHASH=9528A0E91E28FBB88AD433FEABCA2456</Hashes> <!-- Mimikatz -->
			<Hashes condition="contains">IMPHASH=9DA6D5D77BE11712527DCAB86DF449A3</Hashes> <!-- Mimikatz -->
			<Hashes condition="contains">IMPHASH=A6E01BC1AB89F8D91D9EAB72032AAE88</Hashes> <!-- Mimikatz -->
			<Hashes condition="contains">IMPHASH=B24C5EDDAEA4FE50C6A96A2A133521E4</Hashes> <!-- Mimikatz -->
			<Hashes condition="contains">IMPHASH=D21BBC50DCC169D7B4D0F01962793154</Hashes> <!-- Mimikatz -->
			<Hashes condition="contains">IMPHASH=FCC251CCEAE90D22C392215CC9A2D5D6</Hashes> <!-- Mimikatz -->
			<Hashes condition="contains">IMPHASH=23867A89C2B8FC733BE6CF5EF902F2D1</Hashes> <!-- JuicyPotato  -->
			<Hashes condition="contains">IMPHASH=A37FF327F8D48E8A4D2F757E1B6E70BC</Hashes> <!-- JuicyPotato  -->
			<Hashes condition="contains">IMPHASH=6118619783FC175BC7EBECFF0769B46E</Hashes> <!-- RoguePotato -->
			<Hashes condition="contains">IMPHASH=959A83047E80AB68B368FDB3F4C6E4EA</Hashes> <!-- RoguePotato -->
			<Hashes condition="contains">IMPHASH=563233BFA169ACC7892451F71AD5850A</Hashes> <!-- RoguePotato -->
			<Hashes condition="contains">IMPHASH=87575CB7A0E0700EB37F2E3668671A08</Hashes> <!-- RoguePotato -->
			<Hashes condition="contains">IMPHASH=13F08707F759AF6003837A150A371BA1</Hashes> <!-- Pwdump -->
			<Hashes condition="contains">IMPHASH=1781F06048A7E58B323F0B9259BE798B</Hashes> <!-- Pwdump -->
			<Hashes condition="contains">IMPHASH=233F85F2D4BC9D6521A6CAAE11A1E7F5</Hashes> <!-- Pwdump -->
			<Hashes condition="contains">IMPHASH=24AF2584CBF4D60BBE5C6D1B31B3BE6D</Hashes> <!-- Pwdump -->
			<Hashes condition="contains">IMPHASH=632969DDF6DBF4E0F53424B75E4B91F2</Hashes> <!-- Pwdump -->
			<Hashes condition="contains">IMPHASH=713C29B396B907ED71A72482759ED757</Hashes> <!-- Pwdump -->
			<Hashes condition="contains">IMPHASH=749A7BB1F0B4C4455949C0B2BF7F9E9F</Hashes> <!-- Pwdump -->
			<Hashes condition="contains">IMPHASH=8628B2608957A6B0C6330AC3DE28CE2E</Hashes> <!-- Pwdump -->
			<Hashes condition="contains">IMPHASH=8B114550386E31895DFAB371E741123D</Hashes> <!-- Pwdump -->
			<Hashes condition="contains">IMPHASH=94CB940A1A6B65BED4D5A8F849CE9793</Hashes> <!-- PwDumpX -->
			<Hashes condition="contains">IMPHASH=9D68781980370E00E0BD939EE5E6C141</Hashes> <!-- Pwdump -->
			<Hashes condition="contains">IMPHASH=B18A1401FF8F444056D29450FBC0A6CE</Hashes> <!-- Pwdump -->
			<Hashes condition="contains">IMPHASH=CB567F9498452721D77A451374955F5F</Hashes> <!-- Pwdump -->
			<Hashes condition="contains">IMPHASH=730073214094CD328547BF1F72289752</Hashes> <!-- Htran -->
			<Hashes condition="contains">IMPHASH=17B461A082950FC6332228572138B80C</Hashes> <!-- Cobalt Strike beacons -->
			<Hashes condition="contains">IMPHASH=DC25EE78E2EF4D36FAA0BADF1E7461C9</Hashes> <!-- Cobalt Strike beacons -->
			<Hashes condition="contains">IMPHASH=819B19D53CA6736448F9325A85736792</Hashes> <!-- Cobalt Strike beacons -->
			<Hashes condition="contains">IMPHASH=829DA329CE140D873B4A8BDE2CBFAA7E</Hashes> <!-- Cobalt Strike beacons -->
			<Hashes condition="contains">IMPHASH=C547F2E66061A8DFFB6F5A3FF63C0A74</Hashes> <!-- PPLDump -->
			<Hashes condition="contains">IMPHASH=0588081AB0E63BA785938467E1B10CCA</Hashes> <!-- PPLDump -->
			<Hashes condition="contains">IMPHASH=0D9EC08BAC6C07D9987DFD0F1506587C</Hashes> <!-- NanoDump -->
			<Hashes condition="contains">IMPHASH=BC129092B71C89B4D4C8CDF8EA590B29</Hashes> <!-- NanoDump -->
			<Hashes condition="contains">IMPHASH=4DA924CF622D039D58BCE71CDF05D242</Hashes> <!-- NanoDump -->
			<Hashes condition="contains">IMPHASH=E7A3A5C377E2D29324093377D7DB1C66</Hashes> <!-- NanoDump -->
			<Hashes condition="contains">IMPHASH=9A9DBEC5C62F0380B4FA5FD31DEFFEDF</Hashes> <!-- NanoDump -->
			<Hashes condition="contains">IMPHASH=AF8A3976AD71E5D5FDFB67DDB8DADFCE</Hashes> <!-- NanoDump -->
			<Hashes condition="contains">IMPHASH=0C477898BBF137BBD6F2A54E3B805FF4</Hashes> <!-- NanoDump -->
			<Hashes condition="contains">IMPHASH=0CA9F02B537BCEA20D4EA5EB1A9FE338</Hashes> <!-- NanoDump -->
			<Hashes condition="contains">IMPHASH=3AB3655E5A14D4EEFC547F4781BF7F9E</Hashes> <!-- NanoDump -->
			<Hashes condition="contains">IMPHASH=E6F9D5152DA699934B30DAAB206471F6</Hashes> <!-- NanoDump -->
			<Hashes condition="contains">IMPHASH=3AD59991CCF1D67339B319B15A41B35D</Hashes> <!-- NanoDump -->
			<Hashes condition="contains">IMPHASH=FFDD59E0318B85A3E480874D9796D872</Hashes> <!-- NanoDump -->
			<Hashes condition="contains">IMPHASH=0CF479628D7CC1EA25EC7998A92F5051</Hashes> <!-- NanoDump -->
			<Hashes condition="contains">IMPHASH=07A2D4DCBD6CB2C6A45E6B101F0B6D51</Hashes> <!-- NanoDump -->
			<Hashes condition="contains">IMPHASH=D6D0F80386E1380D05CB78E871BC72B1</Hashes> <!-- NanoDump -->
			<Hashes condition="contains">IMPHASH=38D9E015591BBFD4929E0D0F47FA0055</Hashes> <!-- HandleKatz -->
			<Hashes condition="contains">IMPHASH=0E2216679CA6E1094D63322E3412D650</Hashes> <!-- HandleKatz -->
			<Hashes condition="contains">IMPHASH=ADA161BF41B8E5E9132858CB54CAB5FB</Hashes> <!-- DripLoader -->
			<Hashes condition="contains">IMPHASH=2A1BC4913CD5ECB0434DF07CB675B798</Hashes> <!-- DripLoader -->
			<Hashes condition="contains">IMPHASH=11083E75553BAAE21DC89CE8F9A195E4</Hashes> <!-- DripLoader -->
			<Hashes condition="contains">IMPHASH=A23D29C9E566F2FA8FFBB79267F5DF80</Hashes> <!-- DripLoader -->
			<Hashes condition="contains">IMPHASH=4A07F944A83E8A7C2525EFA35DD30E2F</Hashes> <!-- CreateMiniDump -->
			<Hashes condition="contains">IMPHASH=767637C23BB42CD5D7397CF58B0BE688</Hashes> <!-- UACMe Akagi -->
			<Hashes condition="contains">IMPHASH=14C4E4C72BA075E9069EE67F39188AD8</Hashes> <!-- UACMe Akagi -->
			<Hashes condition="contains">IMPHASH=3C782813D4AFCE07BBFC5A9772ACDBDC</Hashes> <!-- UACMe Akagi -->
			<Hashes condition="contains">IMPHASH=7D010C6BB6A3726F327F7E239166D127</Hashes> <!-- UACMe Akagi -->
			<Hashes condition="contains">IMPHASH=89159BA4DD04E4CE5559F132A9964EB3</Hashes> <!-- UACMe Akagi -->
			<Hashes condition="contains">IMPHASH=6F33F4A5FC42B8CEC7314947BD13F30F</Hashes> <!-- UACMe Akagi -->
			<Hashes condition="contains">IMPHASH=5834ED4291BDEB928270428EBBAF7604</Hashes> <!-- UACMe Akagi -->
			<Hashes condition="contains">IMPHASH=5A8A8A43F25485E7EE1B201EDCBC7A38</Hashes> <!-- UACMe Akagi -->
			<Hashes condition="contains">IMPHASH=DC7D30B90B2D8ABF664FBED2B1B59894</Hashes> <!-- UACMe Akagi -->
			<Hashes condition="contains">IMPHASH=41923EA1F824FE63EA5BEB84DB7A3E74</Hashes> <!-- UACMe Akagi -->
			<Hashes condition="contains">IMPHASH=3DE09703C8E79ED2CA3F01074719906B</Hashes> <!-- UACMe Akagi -->
			<Hashes condition="contains">IMPHASH=A53A02B997935FD8EEDCB5F7ABAB9B9F</Hashes> <!-- WCE -->
			<Hashes condition="contains">IMPHASH=E96A73C7BF33A464C510EDE582318BF2</Hashes> <!-- WCE -->
			<Hashes condition="contains">IMPHASH=32089B8851BBF8BC2D014E9F37288C83</Hashes> <!-- Sliver Stagers -->
			<Hashes condition="contains">IMPHASH=09D278F9DE118EF09163C6140255C690</Hashes> <!-- Dumpert -->
			<Hashes condition="contains">IMPHASH=03866661686829D806989E2FC5A72606</Hashes> <!-- Dumpert -->
			<Hashes condition="contains">IMPHASH=E57401FBDADCD4571FF385AB82BD5D6D</Hashes> <!-- Dumpert -->
			<!-- Microsoft Office Programs Dropping Executables -->
			<Image condition="image">winword.exe</Image>
			<Image condition="image">excel.exe</Image>
			<Image condition="image">powerpnt.exe</Image>
			<Image condition="image">msaccess.exe</Image>
			<Image condition="image">mspub.exe</Image>
			<Image condition="image">eqnedt32.exe</Image>
			<Image condition="image">visio.exe</Image>
			<Image condition="image">wordpad.exe</Image>
			<Image condition="image">wordview.exe</Image>
			<Image condition="image">msohtmed.exe</Image>
			<Image condition="image">outlook.exe</Image>
			<!-- LOLBINs that can be used to download executables -->
			<Image condition="image">certutil.exe</Image>
			<Image condition="image">certoc.exe</Image>
			<Image condition="image">CertReq.exe</Image>
			<!-- <Image condition="image">bitsadmin.exe</Image> (depends on the environment; comment in if you're sure that bitsadmin doesn't do that in your env) -->
			<Image condition="image">Desktopimgdownldr.exe</Image>
			<Image condition="image">esentutl.exe</Image>
			<!-- <Image condition="image">expand.exe</Image> (depends on the environment; comment in if you're sure that expand doesn't do that in your env) -->
			<Image condition="image">finger.exe</Image>
			<Image condition="image">presentationhost.exe</Image>
			<!-- Executables that should never drop an executable to disk (but may after a previous process injection or if it's malware that uses a legitimate name)-->
			<Image condition="image">notepad.exe</Image>
			<Image condition="image">AcroRd32.exe</Image>
			<Image condition="image">RdrCEF.exe</Image>
			<Image condition="image">mshta.exe</Image>
			<Image condition="image">hh.exe</Image>
			<Image condition="image">calc.exe</Image>
			<Image condition="image">mspaint.exe</Image>
		</FileBlockExecutable>

		<FileBlockExecutable onmatch="exclude">
			<!-- Exclude executable file that stored by EDR and AV -->
			<TargetFilename condition="begin with">C:\ProgramData\Microsoft\Windows Defender\Quarantine\</TargetFilename>
			<TargetFilename condition="begin with">C:\Windows\fireeye\</TargetFilename>
			<TargetFilename condition="begin with">C:\Windows\CarbonBlack\</TargetFilename>
			<TargetFilename condition="begin with">C:\ProgramData\Symantec\</TargetFilename>
			<TargetFilename condition="begin with">C:\ProgramData\Norton\</TargetFilename>
			<TargetFilename condition="begin with">C:\Program Files\Trend Micro\</TargetFilename>
			<TargetFilename condition="begin with">C:\ProgramData\Kaspersky Lab\</TargetFilename>
			<TargetFilename condition="begin with">C:\Windows\System32\Drivers\CrowdStrike\Quarantine\</TargetFilename>
		</FileBlockExecutable>
	</RuleGroup>

	

	</EventFiltering>
</Sysmon>