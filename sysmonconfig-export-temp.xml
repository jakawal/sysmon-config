<!--
  A Sysmon configuration file
  Author: 		Jakawal Ongthongkum
  Version:		1.0
  Created:		2021-08-09
  Updated: 		2021-08-11
-->

<Sysmon schemaversion="4.50">
	<!-- SYSMON META CONFIG -->
	<HashAlgorithms>md5,sha256</HashAlgorithms>
	<!-- Both MD5 and SHA256 are the industry-standard algorithms -->
	<CheckRevocation>False</CheckRevocation> 
	<!-- Check loaded drivers, log if their code-signing certificate has been revoked, in case malware stole one to sign a kernel driver -->
	<!-- Setting this to true might impact performance -->
	<DnsLookup>False</DnsLookup>
  	<!-- Disables lookup behavior, default is True (Boolean) -->
	<ArchiveDirectory>Sysmon</ArchiveDirectory>
	<!-- Name of directories at volume roots into which copy-on-delete files are moved. The directory is protected with a System ACL --> 
	<!-- You can use PsExec from Sysinternals to access the directory using psexec -sid cmd). Default: Sysmon -->

	<EventFiltering>

	<!--SYSMON EVENT ID 7 : DLL (IMAGE) LOADED BY PROCESS [ImageLoad]-->
	<!--DATA: UtcTime, ProcessGuid, ProcessId, Image, ImageLoaded, Hashes, Signed, Signature, SignatureStatus-->
	<!--Caution: Can cause high system load, disabled by default.-->
	<RuleGroup groupRelation="or">
		<ImageLoad onmatch="include">
			<Rule groupRelation="and">
				<OriginalFileName name="T1059.001,PowerShell" condition="is">amsi.dll</OriginalFileName>
				<Image condition="excludes any">powershell.exe;powershell_ise.exe</Image>
			</Rule>
			<Rule groupRelation="and">
				<Image name="T0137.005,Startup_Items" condition="end with">bginfo.exe</Image>
				<ImageLoaded condition="contains any">System.ni.dll;System.Core.ni.dll</ImageLoaded>
			</Rule>
			<ImageLoaded name="T1197,BITS" condition="end with">bitsproxy.dll</ImageLoaded>
			<Rule groupRelation="and">
				<OriginalFileName name="T1055,Process_Injection" condition="is">clr.dll</OriginalFileName>
				<Image condition="excludes">C:\Windows\Microsoft.NET\</Image>
			</Rule>
			<Rule groupRelation="and">
				<OriginalFileName name="T1055,Process_Injection" condition="is">clrjit.dll</OriginalFileName>
				<Image condition="excludes">C:\Windows\Microsoft.NET\</Image>
			</Rule>
			<Rule groupRelation="and">
				<OriginalFileName name="T1055,Process_Injection" condition="is">mscoreei.dll</OriginalFileName>
				<Image condition="excludes">C:\Windows\Microsoft.NET\</Image>
			</Rule>
			<Rule groupRelation="and">
				<OriginalFileName name="T1055,Process_Injection" condition="is">mscoree.dll</OriginalFileName>
				<Image condition="excludes">C:\Windows\Microsoft.NET\</Image>
			</Rule>
			<Rule groupRelation="and">
				<OriginalFileName name="T1055,Process_Injection" condition="is">mscoreeis.dll</OriginalFileName>
				<Image condition="excludes">C:\Windows\Microsoft.NET\</Image>
			</Rule>
			<Rule groupRelation="and">
				<OriginalFileName name="T1055,Process_Injection" condition="is">mscorlib.dll</OriginalFileName>
				<Image condition="excludes">C:\Windows\Microsoft.NET\</Image>
			</Rule>
			<Rule groupRelation="and">
				<OriginalFileName name="T1055,Process_Injection" condition="is">mscorlib.ni.dll</OriginalFileName>
				<Image condition="excludes">C:\Windows\Microsoft.NET\</Image>
			</Rule>
			<ImageLoaded name="T1047,Windows_Scheduled_Tasks" condition="end with">mstask.dll</ImageLoaded>
			<ImageLoaded name="T1064,Windows_Scripting_Host_Component" condition="end with">wshom.ocx</ImageLoaded>
			<OriginalFileName condition="is">scrrun.dll</OriginalFileName>
			<OriginalFileName condition="is">vbscript.dll</OriginalFileName>
			<Rule groupRelation="and">
				<OriginalFileName name="T1170,MSHTA_with_AMSI_Bypass" condition="is">jscript.dll</OriginalFileName>
				<Image condition="end with">mshta.exe</Image>
			</Rule>
			<Rule groupRelation="and">
				<OriginalFileName name="T1170,MSHTA_with_AMSI_Bypass" condition="is">jscript9.dll</OriginalFileName>
				<Image condition="end with">mshta.exe</Image>
			</Rule>
			<ImageLoaded name="T1137,Office_Application_Startup" condition="end with">.wll</ImageLoaded>
			<ImageLoaded name="T1137,Office_Application_Startup" condition="end with">.xll</ImageLoaded>
			<Rule groupRelation="and">
				<Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
				<OriginalFileName name="T1175,Component_Object_Model_and_Distributed_COM" condition="is">combase.dll</OriginalFileName>
			</Rule>
			<Rule groupRelation="and">
				<Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
				<OriginalFileName name="T1175,Component_Object_Model_and_Distributed_COM" condition="is">coml2.dll</OriginalFileName>
			</Rule>
			<Rule groupRelation="and">
				<Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
				<OriginalFileName name="T1175,Component_Object_Model_and_Distributed_COM" condition="is">comsvcs.dll</OriginalFileName>
			</Rule>
			<Rule groupRelation="and" name="T1055,Process_Injection">
				<Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
				<ImageLoaded condition="begin with">C:\Windows\assembly\</ImageLoaded>
			</Rule>
			<Rule groupRelation="and" name="T1055,Process_Injection">
				<Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
				<ImageLoaded condition="begin with">C:\Windows\Microsoft.NET\assembly\GAC_MSIL</ImageLoaded>
			</Rule>
			<Rule groupRelation="and" name="T1055,Process_Injection">
				<Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
				<OriginalFileName condition="is">clr.dll</OriginalFileName>
			</Rule>
			<Rule groupRelation="and" name="T1059.005,Command_and_Scripting_Interpreter_VBScript">
				<Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
				<OriginalFileName condition="is">VBE7INTL.DLL</OriginalFileName>
			</Rule>
			<Rule groupRelation="and" name="T1059.005,Command_and_Scripting_Interpreter_VBScript">
				<Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
				<OriginalFileName condition="is">VBE7.DLL</OriginalFileName>
			</Rule>
			<Rule groupRelation="and" name="T1059.005,Command_and_Scripting_Interpreter_VBScript">
				<Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
				<OriginalFileName condition="is">VBEUI.DLL</OriginalFileName>
			</Rule>
			<Rule groupRelation="and" name="T1137.001,Office_Template_Macros">
				<Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
				<OriginalFileName condition="is">OUTLVBA.DLL</OriginalFileName>
			</Rule>
			<Image name="T1137,Office_Application_Startup" condition="end with">VSTOInstaller.exe</Image>
			<Rule groupRelation="and">
				<Image name="T1047,Windows_Management_Instrumentation" condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
				<ImageLoaded condition="is">C:\Windows\SysWOW64\wbem\wbemdisp.dll</ImageLoaded>
			</Rule>
			<ImageLoaded name="T1059.001,PowerShell" condition="end with">system.management.automation.ni.dll</ImageLoaded>
			<ImageLoaded name="T1059.001,PowerShell" condition="end with">system.management.automation.dll</ImageLoaded>
			<ImageLoaded name="T1059.001,PowerShell" condition="end with">Microsoft.PowerShell.Commands.Diagnostics.dll</ImageLoaded>
			<ImageLoaded name="T1059.001,PowerShell" condition="end with">Microsoft.PowerShell.Commands.Management.dll</ImageLoaded>
			<ImageLoaded name="T1059.001,PowerShell" condition="end with">Microsoft.PowerShell.Commands.Utility.dll</ImageLoaded>
			<ImageLoaded name="T1059.001,PowerShell" condition="end with">Microsoft.PowerShell.ConsoleHost.dll</ImageLoaded>
			<ImageLoaded name="T1059.001,PowerShell" condition="end with">Microsoft.PowerShell.Security.dll</ImageLoaded>
			<ImageLoaded name="1210,Exploitation_of_Remote_Services" condition="begin with">C:\Windows\System32\spool\drivers\</ImageLoaded>
			<OriginalFileName name="T1112,Modify_Registry" condition="is">regsvc.dll</OriginalFileName>
			<Rule groupRelation="and">
				<Image condition="end with">rundll32.exe</Image>
				<OriginalFileName name="T1003.004,LSASS_Memory" condition="is">comsvcs.dll</OriginalFileName>
			</Rule>
			<OriginalFileName name="T1053,Scheduled_Task" condition="is">taskschd.dll</OriginalFileName>
			<ImageLoaded name="T1218.010,Regsvr32" condition="end with">scrobj.dll</ImageLoaded>
			<OriginalFileName name="T1218.010,Regsvr32" condition="is">scrobj.dll</OriginalFileName>
			<ImageLoaded name="T1073,DLL_Side-Loading" condition="contains any">admin$;c$;\\;\appdata\;\temp\</ImageLoaded>
			<ImageLoaded condition="begin with" name="T1073,DLL_Side-Loading">c:\programdata\</ImageLoaded>
			<ImageLoaded condition="begin with" name="T1073,DLL_Side-Loading">C:\Windows\Media\</ImageLoaded>
			<ImageLoaded condition="begin with" name="T1073,DLL_Side-Loading">C:\Windows\addins\</ImageLoaded>
			<ImageLoaded condition="begin with" name="T1073,DLL_Side-Loading">C:\Windows\system32\config\systemprofile\</ImageLoaded>
			<ImageLoaded condition="begin with" name="T1073,DLL_Side-Loading">C:\Windows\Debug\</ImageLoaded>
			<ImageLoaded condition="begin with" name="T1073,DLL_Side-Loading">C:\Windows\Temp</ImageLoaded>
			<ImageLoaded condition="begin with" name="T1073,DLL_Side-Loading">C:\PerfLogs\</ImageLoaded>
			<ImageLoaded condition="begin with" name="T1073,DLL_Side-Loading">C:\Windows\Help\</ImageLoaded>
			<ImageLoaded condition="begin with" name="T1073,DLL_Side-Loading">C:\Intel\Logs\</ImageLoaded>
			<ImageLoaded condition="begin with" name="T1073,DLL_Side-Loading">C:\Temp</ImageLoaded>
			<ImageLoaded condition="begin with" name="T1073,DLL_Side-Loading">C:\Windows\repair\</ImageLoaded>
			<ImageLoaded condition="begin with" name="T1073,DLL_Side-Loading">C:\Windows\security\</ImageLoaded>
			<ImageLoaded condition="begin with" name="T1073,DLL_Side-Loading">C:\Windows\Fonts\</ImageLoaded>
			<ImageLoaded condition="contains" name="T1073,DLL_Side-Loading">Downloads</ImageLoaded>
			<ImageLoaded condition="contains" name="T1073,DLL_Side-Loading">Public</ImageLoaded>
			<ImageLoaded condition="contains" name="T1073,DLL_Side-Loading">Documents</ImageLoaded>
			<ImageLoaded condition="contains" name="T1073,DLL_Side-Loading">Music</ImageLoaded>
			<ImageLoaded condition="contains" name="T1073,DLL_Side-Loading">Video</ImageLoaded>
			<ImageLoaded condition="begin with" name="T1073,DLL_Side-Loading">file:</ImageLoaded>
			<ImageLoaded name="T1073,DLL_Side-Loading" condition="contains">$Recycle.bin\</ImageLoaded>
			<ImageLoaded name="T1073,DLL_Side-Loading" condition="contains">\Windows\IME\</ImageLoaded>
			<Rule groupRelation="and">
				<OriginalFileName condition="is">urlmon.dll</OriginalFileName>
			</Rule>
			<ImageLoaded name="T1047,Windows_Management_Instrumentation" condition="end with">wmiutils.dll</ImageLoaded>
		</ImageLoad>
	</RuleGroup>

	<RuleGroup groupRelation="or">
		<ImageLoad onmatch="exclude">
			<Rule groupRelation="and">
				<Image condition="is">C:\Windows\System32\cscript.exe</Image>
				<OriginalFileName condition="is">scrobj.dll</OriginalFileName>
			</Rule>
			<Rule groupRelation="and">
				<Image name="T1137,Office_Application_Startup" condition="end with">VSTOInstaller.exe</Image>
				<ImageLoaded condition="begin with">C:\Windows\</ImageLoaded>
			</Rule>
			<Rule groupRelation="and">
				<Image condition="contains all"> C:\Users\;\AppData\Local\Microsoft\OneDrive;\FileCoAuth.exe</Image>
				<ImageLoaded condition="contains all">C:\Users\;\AppData\Local\Microsoft\OneDrive\;\FileSyncTelemetryExtensions.dll</ImageLoaded>
			</Rule>
			<Rule groupRelation="and">
				<Image condition="contains all"> C:\Users\;\AppData\Local\Microsoft\OneDrive;\FileCoAuth.exe</Image>
				<ImageLoaded condition="contains all">C:\Users\;\AppData\Local\Microsoft\OneDrive\;\FileCoAuthLib.dll</ImageLoaded>
			</Rule>
			<Rule groupRelation="and">
				<Image condition="contains all"> C:\Users\;\AppData\Local\Microsoft\OneDrive;\FileCoAuth.exe</Image>
				<ImageLoaded condition="contains all">C:\Users\;\AppData\Local\Microsoft\OneDrive\;\OneDriveTelemetryStable.dll</ImageLoaded>
			</Rule>
			<Rule groupRelation="and">
				<Image condition="contains all"> C:\Users\;\AppData\Local\Microsoft\OneDrive;\FileCoAuth.exe</Image>
				<ImageLoaded condition="contains all">C:\Users\;\AppData\Local\Microsoft\OneDrive\;\vcruntime140.dll</ImageLoaded>
			</Rule>
			<Rule groupRelation="and">
				<Image condition="contains all"> C:\Users\;\AppData\Local\Microsoft\OneDrive;\FileCoAuth.exe</Image>
				<ImageLoaded condition="contains all">C:\Users\;\AppData\Local\Microsoft\OneDrive\;\UpdateRingSettings.dll</ImageLoaded>
			</Rule>
			<Rule groupRelation="and">
				<Image condition="contains all"> C:\Users\;\AppData\Local\Microsoft\OneDrive;\FileCoAuth.exe</Image>
				<ImageLoaded condition="contains all">C:\Users\;\AppData\Local\Microsoft\OneDrive\;\LoggingPlatform.dll</ImageLoaded>
			</Rule>
			<Rule groupRelation="and">
				<Image condition="contains all"> C:\Users\;\AppData\Local\Microsoft\OneDrive;\FileCoAuth.exe</Image>
				<ImageLoaded condition="contains all">C:\Users\;\AppData\Local\Microsoft\OneDrive\;\FileCoAuth.exe</ImageLoaded>
			</Rule>
		</ImageLoad>
	</RuleGroup>

	<!--SYSMON EVENT ID 10 : INTER-PROCESS ACCESS [ProcessAccess]-->
	<!--COMMENT:	Can cause high system load, disabled by default.-->
	<!--DATA: UtcTime, SourceProcessGuid, SourceProcessId, SourceThreadId, SourceImage, TargetProcessGuid, TargetProcessId, TargetImage, GrantedAccess, CallTrace-->
	<RuleGroup groupRelation="or">
		<ProcessAccess onmatch="include">
			<CallTrace name="T1003,Credential_Dumping" condition="contains">dbghelp.dll</CallTrace>
			<CallTrace name="T1003,Credential_Dumping" condition="contains">dbgcore.dll</CallTrace>
			<TargetImage condition="contains">Desktop</TargetImage>
			<Rule groupRelation="and">
				<TargetImage name="T1003,Credential_Dumping" condition="is">C:\Windows\system32\csrss.exe</TargetImage>
				<GrantedAccess>0x1F1FFF</GrantedAccess>
			</Rule>
			<Rule groupRelation="and">
				<TargetImage name="T1003,Credential_Dumping" condition="is">C:\Windows\system32\wininit.exe</TargetImage>
				<GrantedAccess>0x1F1FFF</GrantedAccess>
			</Rule>
			<Rule groupRelation="and">
				<TargetImage name="T1003,Credential_Dumping" condition="is">C:\Windows\system32\winlogon.exe</TargetImage>
				<GrantedAccess>0x1F1FFF</GrantedAccess>
			</Rule>
			<Rule groupRelation="and">
				<TargetImage name="T1003,Credential_Dumping" condition="is">C:\Windows\system32\services.exe</TargetImage>
				<GrantedAccess>0x1F1FFF</GrantedAccess>
			</Rule>
			<GrantedAccess name="T1093,Process Hollowing">0x21410</GrantedAccess>
			<Rule groupRelation="and">
				<TargetImage name="T1003,Credential_Dumping" condition="is">C:\Windows\system32\lsass.exe</TargetImage>
				<GrantedAccess>0x1FFFFF</GrantedAccess>
			</Rule>
			<Rule groupRelation="and">
				<TargetImage name="T1003,Credential_Dumping" condition="is">C:\Windows\system32\lsass.exe</TargetImage>
				<GrantedAccess>0x1F1FFF</GrantedAccess>
			</Rule>
			<Rule groupRelation="and">
				<TargetImage name="T1003,Credential_Dumping" condition="is">C:\Windows\system32\lsass.exe</TargetImage>
				<GrantedAccess>0x1010</GrantedAccess>
			</Rule>
			<Rule groupRelation="and">
				<TargetImage name="T1003,Credential_Dumping" condition="is">C:\Windows\system32\lsass.exe</TargetImage>
				<GrantedAccess>0x143A</GrantedAccess>
			</Rule>
			<Rule groupRelation="and">
				<TargetImage name="T1003,Credential_Dumping" condition="image">lsass.exe</TargetImage>
				<SourceImage name="T1003,Credential_Dumping" condition="image">wsmprovhost.exe</SourceImage>
			</Rule>
			<Rule groupRelation="and" name="T1055,Process_Injection">
				<SourceImage condition="contains all">C:\Program Files;\Microsoft Office\Root\Office</SourceImage>
				<CallTrace condition="contains">\Microsoft Shared\VBA</CallTrace>
			</Rule>
			<Rule groupRelation="and">
				<CallTrace name="T1055.001,DLL_Injection" condition="contains all">C:\Windows\SYSTEM32\ntdll.dll;C:\Windows\System32\kernelbase.dll;UNKNOWN</CallTrace>
				<GrantedAccess name="T1055.001,DLL_Injection" condition="contains any">0x1F0FFF;0x1F1FFF;0x143A;0x1410;0x1010;0x1F2FFF;0x1F3FFF;0x1FFFFF</GrantedAccess>
			</Rule>
			<GrantedAccess name="T1093,Process_Hollowing">0x0800</GrantedAccess>
			<GrantedAccess name="T1003,Credential_Dumping">0x0810</GrantedAccess>
			<GrantedAccess name="T1055,Process_Injection">0x0820</GrantedAccess>
			<GrantedAccess name="T1093,Process_Hollowing">0x800</GrantedAccess>
			<GrantedAccess name="T1003,Credential_Dumping">0x810</GrantedAccess>
			<GrantedAccess name="T1055,Process_Injection">0x820</GrantedAccess>
			<SourceImage name="T1036,Masquerading" condition="begin with">C:\PerfLogs\</SourceImage>
			<SourceImage name="T1036,Masquerading" condition="begin with">C:\$Recycle.bin\</SourceImage>
			<SourceImage name="T1036,Masquerading" condition="begin with">C:\Intel\Logs\</SourceImage>
			<SourceImage name="T1036,Masquerading" condition="begin with">C:\Users\Default\</SourceImage>
			<SourceImage name="T1036,Masquerading" condition="begin with">C:\Users\Public\</SourceImage>
			<SourceImage name="T1036,Masquerading" condition="begin with">C:\Users\NetworkService\</SourceImage>
			<SourceImage name="T1036,Masquerading" condition="begin with">C:\Windows\Fonts\</SourceImage>
			<SourceImage name="T1036,Masquerading" condition="begin with">C:\Windows\Debug\</SourceImage>
			<SourceImage name="T1036,Masquerading" condition="begin with">C:\Windows\Media\</SourceImage>
			<SourceImage name="T1036,Masquerading" condition="begin with">C:\Windows\Help\</SourceImage>
			<SourceImage name="T1036,Masquerading" condition="begin with">C:\Windows\addins\</SourceImage>
			<SourceImage name="T1036,Masquerading" condition="begin with">C:\Windows\repair\</SourceImage>
			<SourceImage name="T1036,Masquerading" condition="begin with">C:\Windows\security\</SourceImage>
			<SourceImage name="T1036,Masquerading" condition="begin with">C:\Windows\system32\config\systemprofile\</SourceImage>
			<SourceImage name="T1036,Masquerading" condition="contains">VolumeShadowCopy</SourceImage>
			<SourceImage name="T1036,Masquerading" condition="contains">\htdocs\</SourceImage>
			<SourceImage name="T1036,Masquerading" condition="contains">\wwwroot\</SourceImage>
			<SourceImage name="T1036,Masquerading" condition="contains">\Temp\</SourceImage>
			<Rule groupRelation="and">
				<SourceImage name="T1036,Masquerading" condition="contains">\AppData\</SourceImage>
				<SourceImage condition="not end with">\AppData\Local\Microsoft\Teams\current\Teams.exe</SourceImage>
			</Rule>
			<Rule groupRelation="and">
				<CallTrace name="T1059.001,PowerShell" condition="contains">System.Management.Automation.ni.dll</CallTrace>
				<SourceImage condition="is not">C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe</SourceImage>
			</Rule>
		</ProcessAccess>
	</RuleGroup>

	<RuleGroup groupRelation="or">
		<ProcessAccess onmatch="exclude">
			<SourceImage condition="is">C:\Program Files\Adobe\Adobe Creative Cloud Experience\libs\node.exe</SourceImage>
			<SourceImage condition="contains all">C:\Program Files;\Common Files\Adobe\AdobeGCClient\AGMService.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files (x86)\Adobe\Acrobat DC\Acrobat\Acrobat.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files (x86)\Adobe\Acrobat DC\Acrobat\AcroCEF\AcroCEF.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files (x86)\Common Files\Adobe\ARM\1.0\AdobeARMHelper.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files\Adobe\Adobe Photoshop 2021\Photoshop.exe</SourceImage>
			<TargetImage condition="begin with">C:\Program Files\Autodesk\Autodesk Desktop App</TargetImage>
			<TargetImage condition="begin with">C:\Program Files (x86)\Autodesk\Autodesk Desktop App</TargetImage>
			<SourceImage condition="is">C:\Windows\CarbonBlack\cb.exe</SourceImage>
			<SourceImage condition="contains all">C:\Program Files\Cisco\AMP\;sfc.exe</SourceImage>
			<SourceImage condition="contains all">C:\Users\;\AppData\Local\Cirtix\ICA Client\receiver\Receiver.exe</SourceImage>
			<SourceImage condition="is">c:\Program Files\Couchbase\Server\bin\sigar_port.exe</SourceImage>
			<SourceImage condition="contains all">C:\Program Files;\FireEye\xagt\xagt.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files (x86)\Ivanti\Workspace Control\cpushld.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files (x86)\RES Software\Workspace Manager\cpushld.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files\Ivanti\Workspace Control\cpushld.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files\RES Software\Workspace Manager\cpushld.exe</SourceImage>
			<SourceImage condition="end with">wmiprvse.exe</SourceImage>
			<SourceImage condition="end with">GoogleUpdate.exe</SourceImage>
			<SourceImage condition="end with">LTSVC.exe</SourceImage>
			<SourceImage condition="end with">taskmgr.exe</SourceImage>
			<SourceImage condition="end with">VBoxService.exe</SourceImage>
			<SourceImage condition="end with">vmtoolsd.exe</SourceImage>
			<SourceImage condition="end with">\Citrix\System32\wfshell.exe</SourceImage>
			<SourceImage condition="is">C:\Windows\System32\lsm.exe</SourceImage>
			<SourceImage condition="end with">Microsoft.Identity.AadConnect.Health.AadSync.Host.exe</SourceImage>
			<SourceImage condition="begin with">C:\Program Files (x86)\Symantec\Symantec Endpoint Protection</SourceImage>
			<GrantedAccess>0x1000</GrantedAccess>
			<GrantedAccess>0x1400</GrantedAccess>
			<GrantedAccess>0x101400</GrantedAccess>
			<GrantedAccess>0x101000</GrantedAccess>
			<SourceImage condition="is">C:\Program Files\McAfee\Endpoint Security\Endpoint Security Platform\mfeesp.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files\McAfee\Agent\x86\macompatsvc.exe</SourceImage>
			<SourceImage condition="contains all">C:\Users\;\AppData\Local\Microsoft\OneDrive\StandaloneUpdater\OneDriveSetup.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files\Microsoft Office\root\Office16\OUTLOOK.EXE</SourceImage>
			<Rule groupRelation="and">
				<SourceImage condition="contains all">C:\Users\;\AppData\Local\Microsoft\Teams\current\Teams.exe</SourceImage>
				<TargetImage condition="contains all">C:\Users\;\AppData\Local\Microsoft\Teams\current\Teams.exe</TargetImage>
			</Rule>
			<SourceImage condition="is">C:\Program Files\Microsoft Security Client\MsMpEng.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files\Windows Defender\MsMpEng.exe</SourceImage>
			<SourceImage condition="contains all">C:\ProgramData\Microsoft\Windows Defender\Platform\;\MsMpEng.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files (x86)\Mobatek\MobaXterm\MobaXterm.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files\Palo Alto Networks\Traps\cyserver.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files\Qualys\QualysAgent\QualysAgent.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files (x86)\Razer Chroma SDK\bin\RzSDKService.exe</SourceImage>
			<SourceImage condition="is">C:\WINDOWS\CCM\CcmExec.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files\Splunk\bin\splunkd.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files (x86)\VMware\VMWare Player\vmware-authd.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files (x86)\VMware\VMware Workstation\vmware-authd.exe</SourceImage>
			<SourceImage condition="is">C:\Program Files\WinZip\FAHWindow64.exe</SourceImage>
		</ProcessAccess>
	</RuleGroup>

	<!--SYSMON EVENT ID 19 & 20 & 21 : WMI EVENT MONITORING [WmiEvent]-->
	<!--EVENT 19: "WmiEventFilter activity detected"-->
	<!--EVENT 20: "WmiEventConsumer activity detected"-->
	<!--EVENT 21: "WmiEventConsumerToFilter activity detected"-->
	<!--DATA: EventType, UtcTime, Operation, User, Name, Type, Destination, Consumer, Filter-->
	<RuleGroup groupRelation="or">
		<WmiEvent onmatch="include">
		  	<Operation name="T1047,Windows_Management_Instrumentation" condition="is">Created</Operation>
		</WmiEvent>
	</RuleGroup>

	</EventFiltering>
</Sysmon>